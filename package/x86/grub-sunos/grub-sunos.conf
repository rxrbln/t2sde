# --- T2-COPYRIGHT-NOTE-BEGIN ---
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# 
# T2 SDE: package/.../grub-sunos/grub-sunos.conf
# Copyright (C) 2008 The T2 SDE Project
# 
# More information can be found in the files COPYING and README.
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; version 2 of the License. A copy of the
# GNU General Public License can be found in the file COPYING.
# --- T2-COPYRIGHT-NOTE-END ---

# inherit main grub package
. $base/package/*/grub/grub.conf

# as we want to re-use the grub module stone module we have to install
# the module manually
if set | grep install_stone_module -q; then
	hook_add postinstall 3 "install_stone_module $base/package/*/grub/stone_mod_grub.sh"
fi

# we only want to build the UNDI netboot flavor (due to some #ifdef bugs
# non-UNDI drivers do nto build due unresolved symbols at the time of
# writing, anyway)
grub_build_diskless() {
	var_append confopt ' ' '--enable-diskless --enable-undi'

	echo Running "./configure $confopt"
	eval "./configure $confopt"
	echo Running "make -C netboot clean; make"
	make -C netboot clean; make
	cp stage2/pxegrub $root/boot/grub/pxegrub
	cp stage2/nbgrub  $root/boot/grub/nbgrub
}
