# --- T2-COPYRIGHT-NOTE-BEGIN ---
# T2 SDE: package/*/cargo/cargo.conf
# Copyright (C) 2018 - 2021 The T2 SDE Project
# 
# This Copyright note is generated by scripts/Create-CopyPatch,
# more information can be found in the files COPYING and README.
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License version 2.
# --- T2-COPYRIGHT-NOTE-END ---

runconf=0
makeopt=
makeinstopt=

cargoopt="--path . --root $root/$prefix --force"

function cargo_config() {
	mkdir -p $CARGO_HOME/

	# TODO: $SDECFG_CC?
	cat <<-EOT > $CARGO_HOME/config
[target.${arch_target/-t2-/-unknown-}]
        #cc = "${archprefix}cc"
        #cxx = "${archprefix}c++"
        #ar = "${archprefix}ar"
        #ranlib = "${archprefix}ranlib"
        linker = "${archprefix}cc"
EOT
}
atstage cross &&
	hook_add premake 5 "cargo_config" &&
	export PKG_CONFIG_ALLOW_CROSS=1 &&
	var_append cargoopt " " "--target ${arch_target/-t2-/-unknown-}" &&
	var_append GCC_WRAPPER_APPEND " " "-c?:-lssh2"

hook_add postmake 5 "cargo install $cargoopt"
