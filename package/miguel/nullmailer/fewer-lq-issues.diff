# --- ROCK-COPYRIGHT-NOTE-BEGIN ---
# 
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# Please add additional copyright information _after_ the line containing
# the ROCK-COPYRIGHT-NOTE-END tag. Otherwise it might get removed by
# the ./scripts/Create-CopyPatch script. Do not edit this copyright text!
# 
# ROCK Linux: rock-src/package/miguel/nullmailer/fewer-lq-issues.diff
# ROCK Linux is Copyright (C) 1998 - 2003 Clifford Wolf
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version. A copy of the GNU General Public
# License can be found at Documentation/COPYING.
# 
# Many people helped and are helping developing ROCK Linux. Please
# have a look at http://www.rocklinux.org/ and the Documentation/TEAM
# file for details.
# 
# --- ROCK-COPYRIGHT-NOTE-END ---

diff -Nru3 nullmailer-1.00RC5/lib/hostname.cc nullmailer/lib/hostname.cc
--- nullmailer-1.00RC5/lib/hostname.cc	2002-12-01 14:15:32.000000000 +0200
+++ nullmailer/lib/hostname.cc	2002-12-01 14:18:36.000000000 +0200
@@ -43,7 +43,7 @@
   hostname_cache = new mystring(buf.nodename);
 
 #ifdef UTSNAME_HAS_DOMAINNAME
-  domainname_cache = new mystring(buf.UTSNAME_HAS_DOMAINNAME);
+  domainname_cache = new mystring(buf.domainname);
 #else
 #ifdef HAVE_GETDOMAINNAME
   char hbuf[256];
diff -Nru3 nullmailer-1.00RC5/protocols/Makefile.in nullmailer/protocols/Makefile.in
--- nullmailer-1.00RC5/protocols/Makefile.in	2000-12-30 06:22:56.000000000 +0200
+++ nullmailer/protocols/Makefile.in	2002-12-01 14:19:20.000000000 +0200
@@ -87,7 +87,7 @@
 DEFS = @DEFS@ -I. -I$(srcdir) -I..
 CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
-LIBS = @LIBS@
+LIBS = @LIBS@ -lstdc++
 smtp_OBJECTS =  smtp.o protocol.o
 smtp_DEPENDENCIES =  ../lib/cli/libcli.a ../lib/libnullmailer.a
 smtp_LDFLAGS = 
diff -Nru3 nullmailer-1.00RC5/src/Makefile.in nullmailer/src/Makefile.in
--- nullmailer-1.00RC5/src/Makefile.in	2002-12-01 14:15:32.000000000 +0200
+++ nullmailer/src/Makefile.in	2002-12-01 14:19:34.000000000 +0200
@@ -104,7 +104,7 @@
 DEFS = @DEFS@ -I. -I$(srcdir) -I..
 CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
-LIBS = @LIBS@
+LIBS = @LIBS@ -lstdc++
 mailq_OBJECTS =  mailq.o
 mailq_DEPENDENCIES =  ../lib/libnullmailer.a
 mailq_LDFLAGS = 
diff -Nru3 nullmailer-1.00RC5/src/send.cc nullmailer/src/send.cc
--- nullmailer-1.00RC5/src/send.cc	2002-12-01 14:15:32.000000000 +0200
+++ nullmailer/src/send.cc	2002-12-01 14:22:23.000000000 +0200
@@ -309,9 +309,17 @@
   signal(SIGHUP, SIG_IGN);
   load_config();
   load_files();
-  for(;;) {
-    send_all();
-    do_select();
+
+  switch(fork()) {
+    case 0:
+      for(;;) {
+	send_all();
+	do_select();
+      }
+    case -1:
+      fout << "Could not fork main send message loop." << endl;
+      return 1;
   }
+
   return 0;
 }
diff -Nru3 nullmailer-1.00RC5/test/Makefile.in nullmailer/test/Makefile.in
--- nullmailer-1.00RC5/test/Makefile.in	2000-12-30 06:22:57.000000000 +0200
+++ nullmailer/test/Makefile.in	2002-12-01 14:19:53.000000000 +0200
@@ -85,7 +85,7 @@
 DEFS = @DEFS@ -I. -I$(srcdir) -I..
 CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
-LIBS = @LIBS@
+LIBS = @LIBS@ -lstdc++
 address_test_OBJECTS =  address-test.o
 address_test_DEPENDENCIES =  ../lib/libnullmailer.a
 address_test_LDFLAGS = 
