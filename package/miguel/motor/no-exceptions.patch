# --- ROCK-COPYRIGHT-NOTE-BEGIN ---
# 
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# Please add additional copyright information _after_ the line containing
# the ROCK-COPYRIGHT-NOTE-END tag. Otherwise it might get removed by
# the ./scripts/Create-CopyPatch script. Do not edit this copyright text!
# 
# ROCK Linux: rock-src/package/jimmy/motor/no-exceptions.patch
# ROCK Linux is Copyright (C) 1998 - 2003 Clifford Wolf
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version. A copy of the GNU General Public
# License can be found at Documentation/COPYING.
# 
# Many people helped and are helping developing ROCK Linux. Please
# have a look at http://www.rocklinux.org/ and the Documentation/TEAM
# file for details.
# 
# --- ROCK-COPYRIGHT-NOTE-END ---

--- ./src/Makefile.in.orig	2002-12-12 19:03:33.000000000 +0200
+++ ./src/Makefile.in	2002-12-15 11:58:56.000000000 +0200
@@ -101,7 +101,7 @@
 CPPFLAGS = -DSHARE_DIR=\"$(pkgdatadir)\" -DLOCALE_DIR=\"$(datadir)/locale\"
 
 bin_PROGRAMS = motor
-motor_SOURCES = main.cc motormisc.cc
+motor_SOURCES = main.cc motormisc.cc motorcommon.cc
 
 EXTRA_DIST = motorcommon.h motormisc.h
 
@@ -122,7 +122,7 @@
 DEFS = @DEFS@ -I. -I$(srcdir) -I..
 LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
-motor_OBJECTS =  main.o motormisc.o
+motor_OBJECTS =  main.o motormisc.o motorcommon.o
 motor_DEPENDENCIES =  project/libproject.a debugger/libdebugger.a \
 executor/libexecutor.a configuration/libconfiguration.a \
 manager/libmanager.a ui/ncurses/libncursesui.a ui/libui.a \
--- ./src/motorcommon.cc.orig	2002-12-15 14:10:28.000000000 +0200
+++ ./src/motorcommon.cc	2002-12-15 11:58:56.000000000 +0200
@@ -0,0 +1,7 @@
+#include "motorcommon.h"
+
+#ifndef MOTOR_USE_EXCEPTIONS
+__MOTOR_BEGIN_NAMESPACE
+jmp_buf motor_jump;
+__MOTOR_END_NAMESPACE
+#endif
--- ./src/motorcommon.h.orig	2001-11-02 09:43:51.000000000 +0200
+++ ./src/motorcommon.h	2002-12-15 11:58:56.000000000 +0200
@@ -60,4 +60,38 @@
 
 #endif
 
+#ifdef __STL_USE_EXCEPTIONS
+#define MOTOR_USE_EXCEPTIONS
+#endif
+
+#ifndef MOTOR_USE_EXCEPTIONS
+
+#ifdef __THROW
+#undef __THROW
+#define __THROW
+#endif
+
+#include <setjmp.h>
+
+__MOTOR_BEGIN_NAMESPACE
+extern jmp_buf motor_jump;
+__MOTOR_END_NAMESPACE
+
+#ifdef try
+#undef try
+#endif
+#define try if(!setjmp(motor_jump))
+
+#ifdef throw
+#undef throw
+#endif
+#define throw(val) longjmp(motor_jump, (val))
+
+#ifdef catch
+#undef catch
+#endif
+#define catch(val) else
+
+#endif
+
 #endif
