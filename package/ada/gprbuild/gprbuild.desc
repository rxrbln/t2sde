[COPY] --- T2-COPYRIGHT-BEGIN ---
[COPY] t2/package/*/gprbuild/gprbuild.desc
[COPY] Copyright (C) 2022 - 2025 The T2 SDE Project
[COPY] SPDX-License-Identifier: GPL-2.0
[COPY] --- T2-COPYRIGHT-END ---

[I] GNAT Project Manager

[T] GPRbuild is an advanced build system designed to help automate
[T] the construction of multi-language systems.

[U] https://github.com/AdaCore/gprbuild

[A] AdaCore
[M] Tomas Glozar <tglozar@gmail.com>

[C] extra/development

[L] GPL
[S] Stable
[V] 25.2.0
[P] X -----5---9 200.500

[D] 0 gprbuild-25.2.0.tar.gz https://github.com/AdaCore/gprbuild/archive/v25.2.0/
[D] 0 gprconfig_kb-25.2.0.tar.gz https://github.com/AdaCore/gprconfig_kb/archive/v25.2.0/
[D] 0 xmlada-25.2.0.tar.gz https://github.com/AdaCore/xmlada/archive/v25.2.0/

gprconfig_extract() {
	tar -xf ../archdir/gprconfig_kb-*.tar.*
	mv gprconfig_kb-* gprconfig_kb
	# Note: gprbuild bootstrap needs xmlada source, not installed xmlada
	if ! which gprbuild >/dev/null; then
		tar -xf ../archdir/xmlada-*.tar.*
		mv xmlada-* xmlada
	fi
}

gprbuild_bootstrap() {
	if ! which gprbuild >/dev/null; then
		# gprbuild requires itself to build
		CC=$HOSTCC ./bootstrap.sh --with-xmlada=./xmlada --with-kb=./gprconfig_kb --prefix=./bootstrap
		export PATH=$PATH:$PWD/bootstrap/bin
	fi
}

hook_add prepatch 2 gprconfig_extract
hook_add preconf 2 gprbuild_bootstrap

# libgpr is needed by gnatcoll
var_append makeinstopt ' ' libgpr.install.static
