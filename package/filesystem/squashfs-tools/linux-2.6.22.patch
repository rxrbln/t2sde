# --- T2-COPYRIGHT-NOTE-BEGIN ---
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# 
# T2 SDE: package/.../squashfs-tools/linux-2.6.22.patch
# Copyright (C) 2007 The T2 SDE Project
# 
# More information can be found in the files COPYING and README.
# 
# This patch file is dual-licensed. It is available under the license the
# patched project is licensed under, as long as it is an OpenSource license
# as defined at http://www.opensource.org/ (e.g. BSD, X11) or under the terms
# of the GNU General Public License as published by the Free Software
# Foundation; either version 2 of the License, or (at your option) any later
# version.
# --- T2-COPYRIGHT-NOTE-END ---

--- squashfs3.2-r2/kernel-patches/linux-2.6.20/squashfs3.2-patch.orig	2007-01-16 03:29:53.000000000 +0100
+++ squashfs3.2-r2/kernel-patches/linux-2.6.20/squashfs3.2-patch	2007-07-09 13:32:53.000000000 +0200
@@ -87,7 +87,7 @@
 diff -x .gitignore -Nurp linux-2.6.20/fs/squashfs/inode.c linux-2.6.20-squashfs3.2-r2/fs/squashfs/inode.c
 --- linux-2.6.20/fs/squashfs/inode.c	1970-01-01 01:00:00.000000000 +0100
 +++ linux-2.6.20-squashfs3.2-r2/fs/squashfs/inode.c	2007-01-16 02:28:36.000000000 +0000
-@@ -0,0 +1,2329 @@
+@@ -0,0 +1,2327 @@
 +/*
 + * Squashfs - a compressed read only filesystem for Linux
 + *
@@ -121,6 +121,7 @@
 +#include <linux/vfs.h>
 +#include <linux/vmalloc.h>
 +#include <linux/smp_lock.h>
++#include <linux/sched.h>
 +
 +#include "squashfs.h"
 +
@@ -2387,10 +2388,7 @@
 +static void init_once(void * foo, struct kmem_cache * cachep, unsigned long flags)
 +{
 +	struct squashfs_inode_info *ei = foo;
-+
-+	if ((flags & (SLAB_CTOR_VERIFY|SLAB_CTOR_CONSTRUCTOR)) ==
-+							SLAB_CTOR_CONSTRUCTOR)
-+		inode_init_once(&ei->vfs_inode);
++	inode_init_once(&ei->vfs_inode);
 +}
 + 
 +
