# --- T2-COPYRIGHT-NOTE-BEGIN ---
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# 
# T2 SDE: package/.../xf86-video-sunffb/cfb-less-HEAD-fix.patch
# Copyright (C) 2006 The T2 SDE Project
# 
# More information can be found in the files COPYING and README.
# 
# This patch file is dual-licensed. It is available under the license the
# patched project is licensed under, as long as it is an OpenSource license
# as defined at http://www.opensource.org/ (e.g. BSD, X11) or under the terms
# of the GNU General Public License as published by the Free Software
# Foundation; either version 2 of the License, or (at your option) any later
# version.
# --- T2-COPYRIGHT-NOTE-END ---

This is a merge from HEAD to avoid the cfb dependency wich was not
automatically loaded and thus required manual corg.conf module
load hardcoding, a no-go.

  - Rene Rebe <rene@exactcode.de>

diff -ur xf86-video-sunffb-1.0.1.3/ltmain.sh xf86-video-sunffb-1.0.1.3-fixed/ltmain.sh
--- xf86-video-sunffb-1.0.1.3/ltmain.sh	2005-12-21 08:56:29.000000000 +0100
+++ xf86-video-sunffb-1.0.1.3-fixed/ltmain.sh	2006-06-19 11:47:08.340000000 +0200
@@ -3143,9 +3143,9 @@
 
       # Eliminate all temporary directories.
       for path in $notinst_path; do
-	lib_search_path=`$echo "$lib_search_path " | ${SED} -e 's% $path % %g'`
-	deplibs=`$echo "$deplibs " | ${SED} -e 's% -L$path % %g'`
-	dependency_libs=`$echo "$dependency_libs " | ${SED} -e 's% -L$path % %g'`
+	lib_search_path=`$echo " $lib_search_path " | ${SED} -e "s% $path % %g"`
+	deplibs=`$echo " $deplibs " | ${SED} -e "s% -L$path % %g"`
+	dependency_libs=`$echo " $dependency_libs " | ${SED} -e "s% -L$path % %g"`
       done
 
       if test -n "$xrpath"; then
Only in xf86-video-sunffb-1.0.1.3-fixed/src: CVS
diff -ur xf86-video-sunffb-1.0.1.3/src/Makefile.am xf86-video-sunffb-1.0.1.3-fixed/src/Makefile.am
--- xf86-video-sunffb-1.0.1.3/src/Makefile.am	2005-12-14 21:42:18.000000000 +0100
+++ xf86-video-sunffb-1.0.1.3-fixed/src/Makefile.am	2006-06-19 12:31:57.350000000 +0200
@@ -35,38 +35,18 @@
 sunffb_drv_la_SOURCES = \
          ffb_accel.c \
          ffb_attr.c \
-         ffb_bcopy.c \
-         ffb_checks.c \
-         ffb_circle.c \
-         ffb_cplane.c \
          ffb_cursor.c \
          ffb_dac.c \
          ffb_dac.h \
-         ffb_dbe.c \
          ffb_ddc.c \
          ffb_dga.c \
          ffb_driver.c \
          ffb_fifo.h \
-         ffb_frect.c \
-         ffb_fspans.c \
-         ffb_gc.c \
-         ffb_gc.h \
-         ffb_glyph.c \
-         ffb_gspans.c \
          ffb.h \
-         ffb_line.c \
          ffb_loops.h \
-         ffb_plygon.c \
-         ffb_point.c \
          ffb_rcache.h \
          ffb_regs.h \
-         ffb_seg.c \
-         ffb_sspans.c \
-         ffb_stip.c \
-         ffb_stip.h \
-         ffb_stubs.c \
          ffb_wid.c \
-         ffb_zeroarc.c \
          $(SPARC_ASM_SRC)
 
 if DRI 
@@ -74,9 +54,3 @@
          ffb_dri.c \
          ffb_drishare.h
 endif
-
-EXTRA_DIST = \
-         ffb_clip.c \
-         ffb_clip.h \
-         ffb_wline.c \
-         ffb_rect.c
diff -ur xf86-video-sunffb-1.0.1.3/src/Makefile.in xf86-video-sunffb-1.0.1.3-fixed/src/Makefile.in
--- xf86-video-sunffb-1.0.1.3/src/Makefile.in	2005-12-21 08:56:36.000000000 +0100
+++ xf86-video-sunffb-1.0.1.3-fixed/src/Makefile.in	2006-06-19 12:30:34.690000000 +0200
@@ -198,46 +198,22 @@
 sunffb_drv_la_SOURCES = \
          ffb_accel.c \
          ffb_attr.c \
-         ffb_bcopy.c \
-         ffb_checks.c \
-         ffb_circle.c \
-         ffb_cplane.c \
          ffb_cursor.c \
          ffb_dac.c \
          ffb_dac.h \
-         ffb_dbe.c \
          ffb_ddc.c \
          ffb_dga.c \
          ffb_driver.c \
          ffb_fifo.h \
-         ffb_frect.c \
-         ffb_fspans.c \
-         ffb_gc.c \
-         ffb_gc.h \
-         ffb_glyph.c \
-         ffb_gspans.c \
          ffb.h \
-         ffb_line.c \
          ffb_loops.h \
-         ffb_plygon.c \
-         ffb_point.c \
          ffb_rcache.h \
          ffb_regs.h \
-         ffb_seg.c \
-         ffb_sspans.c \
-         ffb_stip.c \
-         ffb_stip.h \
-         ffb_stubs.c \
          ffb_wid.c \
-         ffb_zeroarc.c \
          $(SPARC_ASM_SRC)\
 $(am__append_1)
 
-EXTRA_DIST = \
-         ffb_clip.c \
-         ffb_clip.h \
-         ffb_wline.c \
-         ffb_rect.c
+EXTRA_DIST = 
 
 subdir = src
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
@@ -247,22 +223,19 @@
 LTLIBRARIES = $(sunffb_drv_la_LTLIBRARIES)
 
 sunffb_drv_la_LIBADD =
-am__sunffb_drv_la_SOURCES_DIST = ffb_accel.c ffb_attr.c ffb_bcopy.c \
-	ffb_checks.c ffb_circle.c ffb_cplane.c ffb_cursor.c ffb_dac.c \
-	ffb_dac.h ffb_dbe.c ffb_ddc.c ffb_dga.c ffb_driver.c ffb_fifo.h \
-	ffb_frect.c ffb_fspans.c ffb_gc.c ffb_gc.h ffb_glyph.c \
-	ffb_gspans.c ffb.h ffb_line.c ffb_loops.h ffb_plygon.c \
-	ffb_point.c ffb_rcache.h ffb_regs.h ffb_seg.c ffb_sspans.c \
-	ffb_stip.c ffb_stip.h ffb_stubs.c ffb_wid.c ffb_zeroarc.c \
+am__sunffb_drv_la_SOURCES_DIST = ffb_accel.c ffb_attr.c \
+	ffb_cursor.c ffb_dac.c \
+	ffb_dac.h ffb_ddc.c ffb_dga.c ffb_driver.c ffb_fifo.h \
+	ffb.h ffb_loops.h \
+	ffb_rcache.h ffb_regs.h \
+	ffb_wid.c \
 	ffb_asm.s VISmoveImage.s ffb_dri.c ffb_drishare.h
 @SPARC_TRUE@am__objects_1 = ffb_asm.lo VISmoveImage.lo
 @DRI_TRUE@am__objects_2 = ffb_dri.lo
-am_sunffb_drv_la_OBJECTS = ffb_accel.lo ffb_attr.lo ffb_bcopy.lo \
-	ffb_checks.lo ffb_circle.lo ffb_cplane.lo ffb_cursor.lo \
-	ffb_dac.lo ffb_dbe.lo ffb_ddc.lo ffb_dga.lo ffb_driver.lo \
-	ffb_frect.lo ffb_fspans.lo ffb_gc.lo ffb_glyph.lo ffb_gspans.lo \
-	ffb_line.lo ffb_plygon.lo ffb_point.lo ffb_seg.lo ffb_sspans.lo \
-	ffb_stip.lo ffb_stubs.lo ffb_wid.lo ffb_zeroarc.lo \
+am_sunffb_drv_la_OBJECTS = ffb_accel.lo ffb_attr.lo \
+	ffb_cursor.lo \
+	ffb_dac.lo ffb_ddc.lo ffb_dga.lo ffb_driver.lo \
+	ffb_wid.lo \
 	$(am__objects_1) $(am__objects_2)
 sunffb_drv_la_OBJECTS = $(am_sunffb_drv_la_OBJECTS)
 
@@ -270,23 +243,12 @@
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
 @AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/ffb_accel.Plo \
-@AMDEP_TRUE@	./$(DEPDIR)/ffb_attr.Plo ./$(DEPDIR)/ffb_bcopy.Plo \
-@AMDEP_TRUE@	./$(DEPDIR)/ffb_checks.Plo \
-@AMDEP_TRUE@	./$(DEPDIR)/ffb_circle.Plo \
-@AMDEP_TRUE@	./$(DEPDIR)/ffb_cplane.Plo \
+@AMDEP_TRUE@	./$(DEPDIR)/ffb_attr.Plo \
 @AMDEP_TRUE@	./$(DEPDIR)/ffb_cursor.Plo ./$(DEPDIR)/ffb_dac.Plo \
-@AMDEP_TRUE@	./$(DEPDIR)/ffb_dbe.Plo ./$(DEPDIR)/ffb_ddc.Plo \
+@AMDEP_TRUE@	./$(DEPDIR)/ffb_ddc.Plo \
 @AMDEP_TRUE@	./$(DEPDIR)/ffb_dga.Plo ./$(DEPDIR)/ffb_dri.Plo \
 @AMDEP_TRUE@	./$(DEPDIR)/ffb_driver.Plo \
-@AMDEP_TRUE@	./$(DEPDIR)/ffb_frect.Plo \
-@AMDEP_TRUE@	./$(DEPDIR)/ffb_fspans.Plo ./$(DEPDIR)/ffb_gc.Plo \
-@AMDEP_TRUE@	./$(DEPDIR)/ffb_glyph.Plo \
-@AMDEP_TRUE@	./$(DEPDIR)/ffb_gspans.Plo ./$(DEPDIR)/ffb_line.Plo \
-@AMDEP_TRUE@	./$(DEPDIR)/ffb_plygon.Plo \
-@AMDEP_TRUE@	./$(DEPDIR)/ffb_point.Plo ./$(DEPDIR)/ffb_seg.Plo \
-@AMDEP_TRUE@	./$(DEPDIR)/ffb_sspans.Plo ./$(DEPDIR)/ffb_stip.Plo \
-@AMDEP_TRUE@	./$(DEPDIR)/ffb_stubs.Plo ./$(DEPDIR)/ffb_wid.Plo \
-@AMDEP_TRUE@	./$(DEPDIR)/ffb_zeroarc.Plo
+@AMDEP_TRUE@	./$(DEPDIR)/ffb_wid.Plo
 COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
 	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
 LTCOMPILE = $(LIBTOOL) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) \
diff -ur xf86-video-sunffb-1.0.1.3/src/ffb.h xf86-video-sunffb-1.0.1.3-fixed/src/ffb.h
--- xf86-video-sunffb-1.0.1.3/src/ffb.h	2005-04-20 14:25:30.000000000 +0200
+++ xf86-video-sunffb-1.0.1.3-fixed/src/ffb.h	2006-06-19 12:31:57.360000000 +0200
@@ -31,7 +31,6 @@
 
 #include "xf86.h"
 #include "xf86_OSproc.h"
-#include "xf86_ansic.h"
 #include "xf86RamDac.h"
 #include "xaa.h"
 #include <X11/Xmd.h>
diff -ur xf86-video-sunffb-1.0.1.3/src/ffb_accel.c xf86-video-sunffb-1.0.1.3-fixed/src/ffb_accel.c
--- xf86-video-sunffb-1.0.1.3/src/ffb_accel.c	2005-07-11 04:30:01.000000000 +0200
+++ xf86-video-sunffb-1.0.1.3-fixed/src/ffb_accel.c	2006-06-19 12:31:57.360000000 +0200
@@ -43,8 +43,6 @@
 #include	"ffb_rcache.h"
 #include	"ffb_loops.h"
 #include	"ffb_regs.h"
-#include	"ffb_stip.h"
-#include 	"ffb_gc.h"
 
 int	CreatorScreenPrivateIndex;
 int	CreatorGCPrivateIndex;
Only in xf86-video-sunffb-1.0.1.3/src: ffb_bcopy.c
Only in xf86-video-sunffb-1.0.1.3/src: ffb_checks.c
Only in xf86-video-sunffb-1.0.1.3/src: ffb_circle.c
Only in xf86-video-sunffb-1.0.1.3/src: ffb_clip.c
Only in xf86-video-sunffb-1.0.1.3/src: ffb_clip.h
Only in xf86-video-sunffb-1.0.1.3/src: ffb_cplane.c
diff -ur xf86-video-sunffb-1.0.1.3/src/ffb_dac.c xf86-video-sunffb-1.0.1.3-fixed/src/ffb_dac.c
--- xf86-video-sunffb-1.0.1.3/src/ffb_dac.c	2005-07-11 04:30:01.000000000 +0200
+++ xf86-video-sunffb-1.0.1.3-fixed/src/ffb_dac.c	2006-06-19 12:31:57.370000000 +0200
@@ -33,7 +33,6 @@
 
 #include "xf86.h"
 #include "xf86_OSproc.h"
-#include "xf86_ansic.h"
 
 #include "xf86DDC.h"
 
Only in xf86-video-sunffb-1.0.1.3/src: ffb_dbe.c
diff -ur xf86-video-sunffb-1.0.1.3/src/ffb_ddc.c xf86-video-sunffb-1.0.1.3-fixed/src/ffb_ddc.c
--- xf86-video-sunffb-1.0.1.3/src/ffb_ddc.c	2005-07-11 04:30:01.000000000 +0200
+++ xf86-video-sunffb-1.0.1.3-fixed/src/ffb_ddc.c	2006-06-19 12:31:57.370000000 +0200
@@ -33,7 +33,6 @@
 
 #include "xf86.h"
 #include "xf86_OSproc.h"
-#include "xf86_ansic.h"
 
 #include "xf86DDC.h"
 
diff -ur xf86-video-sunffb-1.0.1.3/src/ffb_dga.c xf86-video-sunffb-1.0.1.3-fixed/src/ffb_dga.c
--- xf86-video-sunffb-1.0.1.3/src/ffb_dga.c	2005-07-11 04:30:01.000000000 +0200
+++ xf86-video-sunffb-1.0.1.3-fixed/src/ffb_dga.c	2006-06-19 12:31:57.370000000 +0200
@@ -29,14 +29,12 @@
 
 #include "xf86.h"
 #include "xf86_OSproc.h"
-#include "xf86_ansic.h"
 #include "dgaproc.h"
 
 #include "ffb.h"
 #include "ffb_regs.h"
 #include "ffb_rcache.h"
 #include "ffb_fifo.h"
-#include "ffb_stip.h"
 #include "ffb_loops.h"
 
 static Bool FFB_OpenFramebuffer(ScrnInfoPtr, char **, unsigned char **,
diff -ur xf86-video-sunffb-1.0.1.3/src/ffb_dri.c xf86-video-sunffb-1.0.1.3-fixed/src/ffb_dri.c
--- xf86-video-sunffb-1.0.1.3/src/ffb_dri.c	2005-10-21 20:40:19.000000000 +0200
+++ xf86-video-sunffb-1.0.1.3-fixed/src/ffb_dri.c	2006-06-19 12:31:57.370000000 +0200
@@ -26,18 +26,14 @@
 #include "config.h"
 #endif
 
+#include <stdio.h>
+
 #include "xf86.h"
 #include "xf86_OSproc.h"
-#include "xf86_ansic.h"
 #include "xf86Priv.h"
 
 #include "xf86PciInfo.h"
 #include "xf86Pci.h"
-#define PSZ 8
-#include "cfb.h"
-#undef PSZ
-#include "cfb16.h"
-#include "cfb32.h"
 
 #include "miline.h"
 
diff -ur xf86-video-sunffb-1.0.1.3/src/ffb_driver.c xf86-video-sunffb-1.0.1.3-fixed/src/ffb_driver.c
--- xf86-video-sunffb-1.0.1.3/src/ffb_driver.c	2005-11-09 22:31:21.000000000 +0100
+++ xf86-video-sunffb-1.0.1.3-fixed/src/ffb_driver.c	2006-06-19 12:31:57.370000000 +0200
@@ -26,9 +26,10 @@
 #include "config.h"
 #endif
 
+#include <string.h>
+
 #include "xf86.h"
 #include "xf86_OSproc.h"
-#include "xf86_ansic.h"
 #include "xf86Version.h"
 #include "mipointer.h"
 #include "mibstore.h"
@@ -66,12 +67,12 @@
 
 void FFBSync(ScrnInfoPtr pScrn);
 
-#define VERSION 4000
+#define FFB_VERSION 4000
 #define FFB_NAME "SUNFFB"
 #define FFB_DRIVER_NAME "sunffb"
 #define FFB_MAJOR_VERSION 1
-#define FFB_MINOR_VERSION 0
-#define FFB_PATCHLEVEL 1
+#define FFB_MINOR_VERSION 1
+#define FFB_PATCHLEVEL 0
 
 /* 
  * This contains the functions needed by the server after loading the driver
@@ -82,7 +83,7 @@
  */
 
 _X_EXPORT DriverRec SUNFFB = {
-    VERSION,
+    FFB_VERSION,
     FFB_DRIVER_NAME,
     FFBIdentify,
     FFBProbe,
@@ -265,7 +266,7 @@
 	    pScrn = xf86AllocateScreen(drv, 0);
 
 	    /* Fill in what we can of the ScrnInfoRec */
-	    pScrn->driverVersion = VERSION;
+	    pScrn->driverVersion = FFB_VERSION;
 	    pScrn->driverName	 = FFB_DRIVER_NAME;
 	    pScrn->name		 = FFB_NAME;
 	    pScrn->Probe	 = FFBProbe;
@@ -411,11 +412,6 @@
 	xf86DrvMsg(pScrn->scrnIndex, X_CONFIG, "Acceleration disabled\n");
     }
         
-    if (xf86LoadSubModule(pScrn, "xf8_32wid") == NULL) {
-	FFBFreeRec(pScrn);
-	return FALSE;
-    }
-
     if (xf86LoadSubModule(pScrn, "fb") == NULL) {
 	FFBFreeRec(pScrn);
 	return FALSE;
Only in xf86-video-sunffb-1.0.1.3/src: ffb_frect.c
Only in xf86-video-sunffb-1.0.1.3/src: ffb_fspans.c
Only in xf86-video-sunffb-1.0.1.3/src: ffb_gc.c
Only in xf86-video-sunffb-1.0.1.3/src: ffb_gc.h
Only in xf86-video-sunffb-1.0.1.3/src: ffb_glyph.c
Only in xf86-video-sunffb-1.0.1.3/src: ffb_gspans.c
Only in xf86-video-sunffb-1.0.1.3/src: ffb_line.c
Only in xf86-video-sunffb-1.0.1.3/src: ffb_plygon.c
Only in xf86-video-sunffb-1.0.1.3/src: ffb_point.c
Only in xf86-video-sunffb-1.0.1.3/src: ffb_rect.c
Only in xf86-video-sunffb-1.0.1.3/src: ffb_seg.c
Only in xf86-video-sunffb-1.0.1.3/src: ffb_sspans.c
Only in xf86-video-sunffb-1.0.1.3/src: ffb_stip.c
Only in xf86-video-sunffb-1.0.1.3/src: ffb_stip.h
Only in xf86-video-sunffb-1.0.1.3/src: ffb_stubs.c
Only in xf86-video-sunffb-1.0.1.3/src: ffb_wline.c
Only in xf86-video-sunffb-1.0.1.3/src: ffb_zeroarc.c
--- xf86-video-sunffb-1.0.1.3/src/Makefile.in.vanilla	2006-06-19 12:46:19.840000000 +0200
+++ xf86-video-sunffb-1.0.1.3/src/Makefile.in	2006-06-19 12:46:46.580000000 +0200
@@ -311,31 +311,13 @@
 
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ffb_accel.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ffb_attr.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ffb_bcopy.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ffb_checks.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ffb_circle.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ffb_cplane.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ffb_cursor.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ffb_dac.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ffb_dbe.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ffb_ddc.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ffb_dga.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ffb_dri.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ffb_driver.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ffb_frect.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ffb_fspans.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ffb_gc.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ffb_glyph.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ffb_gspans.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ffb_line.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ffb_plygon.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ffb_point.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ffb_seg.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ffb_sspans.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ffb_stip.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ffb_stubs.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ffb_wid.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ffb_zeroarc.Plo@am__quote@
 
 .c.o:
 @am__fastdepCC_TRUE@	if $(COMPILE) -MT $@ -MD -MP -MF "$(DEPDIR)/$*.Tpo" \
