# --- T2-COPYRIGHT-NOTE-BEGIN ---
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# 
# T2 SDE: package/.../ffmpeg/CVE-2005-4048.patch
# Copyright (C) 2006 The T2 SDE Project
# 
# More information can be found in the files COPYING and README.
# 
# This patch file is dual-licensed. It is available under the license the
# patched project is licensed under, as long as it is an OpenSource license
# as defined at http://www.opensource.org/ (e.g. BSD, X11) or under the terms
# of the GNU General Public License as published by the Free Software
# Foundation; either version 2 of the License, or (at your option) any later
# version.
# --- T2-COPYRIGHT-NOTE-END ---

diff -Nur ffmpeg-orig/libavcodec/utils.c ffmpeg/libavcodec/utils.c
--- ffmpeg-orig/libavcodec/utils.c	1999-12-31 23:00:00.000000000 +0000
+++ ffmpeg/libavcodec/utils.c	2006-06-01 13:27:32.691704000 +0000
@@ -327,6 +327,14 @@
             const int h_shift= i==0 ? 0 : h_chroma_shift;
             const int v_shift= i==0 ? 0 : v_chroma_shift;
 
+	    if(s->pix_fmt == PIX_FMT_PAL8 && i == 1)
+	    {
+	        buf->base[i] = av_malloc(256 * 4);
+	        if(buf->base[i] == NULL)
+	            return -1;
+	        buf->data[i] = buf->base[i];
+	        continue;
+	    }
             //FIXME next ensures that linesize= 2^x uvlinesize, thats needed because some MC code assumes it
             buf->linesize[i]= ALIGN(pixel_size*w>>h_shift, STRIDE_ALIGN<<(h_chroma_shift-h_shift)); 
 
