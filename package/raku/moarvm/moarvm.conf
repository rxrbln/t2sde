# --- T2-COPYRIGHT-NOTE-BEGIN ---
# This copyright note is auto-generated by scripts/Create-CopyPatch.
# 
# T2 SDE: package/*/moarvm/moarvm.conf
# Copyright (C) 2021 The T2 SDE Project
# 
# More information can be found in the files COPYING and README.
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; version 2 of the License. A copy of the
# GNU General Public License can be found in the file COPYING.
# --- T2-COPYRIGHT-NOTE-END ---

# Raku toolchain doesn't use autotools, therefore the configure stage has to
# be modified to support its Configure.pl script

# Note: The libraries specified in confopt are required for building MoarVM; if
# they are not present, MoarVM will build and statically link them to itself,
# in some cases alongside installing their headers globally, which is not good.
#
# (libsha1 is excluded, because it doesn't have a T2 package.)

confopt="--prefix=$root/$prefix --has-libtommath --has-libuv --has-libatomic_ops --has-dyncall"

# Optional dependencies
pkginstalled libffi && var_append confopt " " "--has-libffi"

if [ "$arch_build" != "$arch_target" ]
then
  var_append confopt " " "--build=$arch_build"
  var_append confopt " " "--host=$arch_target"
fi

hook_add preconf 2 "perl Configure.pl $confopt"
