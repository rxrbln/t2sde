[COPY] --- T2-COPYRIGHT-BEGIN ---
[COPY] t2/package/*/ghc/ghc.desc
[COPY] Copyright (C) 2009 - 2025 The T2 SDE Project
[COPY] SPDX-License-Identifier: GPL-2.0
[COPY] --- T2-COPYRIGHT-END ---

[I] The Glasgow (flagship) Haskell Compiler

[T] Haskell is an advanced purely functional programming language. An open
[T] source product of more than twenty years of cutting edge research, it
[T] allows rapid development of robust, concise, correct software. With
[T] strong support for integration with other languages, built-in concurrency
[T] and parallelism, debuggers, profilers, rich libraries and an active
[T] community, Haskell makes it easier to produce flexible, maintainable
[T] high-quality software.

[U] https://www.haskell.org/

[A] The University of Glasgow
[M] Riley Beckett <rbeckettvt@gmail.com>

[C] base/development

[L] BSD
[S] Stable
[V] 9.14.1
[P] X -----5---9 500.000

[D] 54f897c63fd16ac9b4d2d1d1cef3c4cc089d332b73288d0cd005c210 ghc-9.14.1-src.tar.xz http://www.haskell.org/ghc/dist/9.14.1/

# this only needs to happen on bootstrap:
# 	download ghc from here: https://downloads.haskell.org/~ghc/9.10.3/ghc-9.10.3-x86_64-alpine3_12-linux-static-int_native.tar.xz
# 	export GHC=/path/to/ghc
# 	download cabal from here: https://downloads.haskell.org/~cabal/cabal-install-3.16.0.0/
# 	export CABAL=/path/to/cabal

. $base/package/*/*/haskell-conf.in
var_append confopt ' ' --target=$arch_target
var_append confopt ' ' --enable-ignore-build-platform-mismatch

# ghc touches these files on install but does not do anything so just ignore them
files=$(find $root/var/adm/flists/* -not -name '*ghc')
packageconfd=$(grep "package.conf.d" $files | sed 's,^.*/\([^/]\.conf\)$,\1,')
for x in $packageconfd; do
	var_append flistrfilter '|' ".*:.*$x.*"
	var_append flistdel '|' ".*$x.*"
done

build_ghc() {
	export CABFLAGS=$(eval echo $setuphsopt)
	./hadrian/build -j${SDECFG_PARALLEL}
}
hook_add inmake 5 build_ghc

install_ghc() {
	./hadrian/build install --docs=none --prefix=$root/$prefix
}
hook_add postmake 5 install_ghc
