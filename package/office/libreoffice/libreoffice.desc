[COPY] --- T2-COPYRIGHT-BEGIN ---
[COPY] t2/package/*/libreoffice/libreoffice.desc
[COPY] Copyright (C) 2004 - 2026 The T2 SDE Project
[COPY] SPDX-License-Identifier: GPL-2.0
[COPY] --- T2-COPYRIGHT-END ---

[I] Libre Open Office Suite

[T] Libreoffice is the community maintained OpenOffice fork.

[U] https://www.libreoffice.org
[U] http://www.go-ooo.org

[A] StarDivision
[A] Sun Microsystems
[A] The Document Foundation
[M] Rene Rebe <rene@t2-project.org>

[C] extra/office
[F] CROSS CUSTOM-LTO.gcc NO-LTO.clang
# some arch just fail linking w/ a symbol or incompatible object format
[R] - ia64 hppa hppa64 riscv superh

# tests xvfb-run
[E] del xorg-server

[L] OpenSource
[S] Stable
[V] 26.2.0.3

# (grep 'curl\|wget'| tr ' ' '\n' | sed -n 's,\(http.*\)/\(.*\),[D] 0 \2 \1/,p' | sort) < libreoffice.log
[D] edbfa4bce6a093cf614e05090dd8c74b2a82a6e75d6586e26818ffc5 libreoffice-26.2.0.3.tar.xz https://download.documentfoundation.org/libreoffice/src/26.2.0/
[D] ac6c094a23858dac77c29b782c1d3ebd530c764d1abeba6dd17c1a40 1f5def51ca0026cd192958ef07228b52-rasqal-0.9.33.tar.gz https://dev-www.libreoffice.org/src/
[D] c9e27a8cc4456a59e726bcef9e8f40b1797bcaf2d7125d5fb07a6096 26b3e95ddf3d9c077c480ea45874b3b8-lp_solve_5.5.tar.gz https://dev-www.libreoffice.org/src/
[D] 843d75ee3475c74891ce1f5b021d8d34bcc5052fa00cf51258bf03d6 48d647fbd8ef8889e5a7f422c1bfda94-clucene-core-2.3.3.4.tar.gz https://dev-www.libreoffice.org/src/
[D] b644d3e1faf8592471208af08b456fdd5be67e68c243220e19e0d870 5ade6ae2a99bc1e9e57031ca88d36dad-hyphen-2.8.8.tar.gz https://dev-www.libreoffice.org/src/
[D] f36cc230810df38389cf4c80fb9bf2fb5cb2eb66a3914e09cab15287 CoinMP-1.8.4.tgz https://dev-www.libreoffice.org/src/
[D] 57ebceb06e5d5a3dff040f0f951c5f453e3e2408111dc29098f59bea afdko-4.0.3.tar.gz https://dev-www.libreoffice.org/src/
[D] 3829e81c64a48392fba162fcda4423b5b1d5e00466df31e72b0595be antlr4-cpp-runtime-4.13.2-source.zip https://dev-www.libreoffice.org/src/
[D] e0d7538228c8da89071c2e49c994cd7a0c5b9cc311ddcb1ba3410426 box2d-2.4.1.tar.gz https://dev-www.libreoffice.org/src/
[D] 10b48784be071d477601863a3056b028997cf1b6bd22ff14c0b38cd8 cppunit-1.15.1.tar.gz https://dev-www.libreoffice.org/src/
[D] 1238182706e413245d0af1f87bdcbcb6a563b7cf888abe6b3afd2725 dragonbox-1.1.3.tar.gz https://dev-www.libreoffice.org/src/
[D] 8a41994b6abf9e1c5a0f2fc89959f41cd2b6179b2c0f6e22aed788f0 e5be03eda13ef68aabab6e42aa67715e-redland-1.0.17.tar.gz https://dev-www.libreoffice.org/src/
[D] 16109c08e73c71f27ce60f86afa89d43218e97728b4637f5b2760177 f543e6e2d7275557a839a164941c0a86e5f2c3f2a0042bfc434c88c6dde9e140-opens___.ttf https://dev-www.libreoffice.org/extern/
[D] e9fe6b8013d1dd2cebd281314474219d0e4c95f748d3d3a4bf385114 fast_float-8.2.2.tar.gz https://dev-www.libreoffice.org/src/
[D] 049e9651240088b8b5edc2e599395c621e1f47724eebd0b72a74341f frozen-1.2.0.tar.gz https://dev-www.libreoffice.org/src/
[D] 714e2061b5ea173f0ddc622a478c613e495bcda3b279618b6d7955a1 glm-1.0.3.zip https://dev-www.libreoffice.org/src/
[D] 5f44e3c562291b7cd71cd8dc64f5b43c3ab719e08c24164fb3654da2 graphite2-minimal-1.3.14.tgz https://dev-www.libreoffice.org/src/
[D] 95f7f33718bc92f3ac4229d33293233c43d13cff948962a1d76bf282 harfbuzz-12.3.0.tar.xz https://dev-www.libreoffice.org/src/
[D] 7417d7cf0f22142f2def19fc4992420c9e47b38710d01a6323072bff language-subtag-registry-2025-08-25.tar.bz2 https://dev-www.libreoffice.org/src/
[D] 09ee0999a8bcfe00c2484bbf2adff0ee77417f9b9a1c94397ed27472 libabw-0.1.3.tar.xz https://dev-www.libreoffice.org/src/
[D] 08eb58d7787a3043cfb809ca39d0e540a098d601c7f173a080fab13f libcmis-0.6.2.tar.xz https://dev-www.libreoffice.org/src/
[D] 4093d24f56e506ed5442f2ba94f9e76355b3e12fa0a77c404da0fd20 libe-book-0.1.3.tar.xz https://dev-www.libreoffice.org/src/
[D] cc7d4281328efd04974c69385f904d44351be323653d5b0e53c6aead libepubgen-0.1.1.tar.xz https://dev-www.libreoffice.org/src/
[D] e6545f4f6759ff93e1b0465bdce8b5478c28a991b33daac0b9d8b26f libetonyek-0.1.13.tar.xz https://dev-www.libreoffice.org/src/
[D] 258be006710bc07f2e12264163220bd8d7e8e12db8cf2fb151e4d174 libexttextcat-3.4.7.tar.xz https://dev-www.libreoffice.org/src/
[D] 77eea8e5d7068f61d296e79d96f655a97e153c1756c1938a0676da4b liblangtag-0.6.8.tar.bz2 https://dev-www.libreoffice.org/src/
[D] 8931b6ba46fb139d58b94170d5a1981c692e0c3aa3bd1bb8ab041ad9 libmwaw-0.3.22.tar.xz https://dev-www.libreoffice.org/src/
[D] 34eb24c0fbeaa98e3525fcdda86b5062c84a84bc5e049de0bdf57a2c libnumbertext-1.0.11.tar.xz https://dev-www.libreoffice.org/src/
[D] 51f3603e40a0b0e25e73cf0ac322c7d9c5eed9ef8a31dee8f1b4a76a libodfgen-0.1.8.tar.xz https://dev-www.libreoffice.org/src/
[D] c55ebb416bbc81cd96b5e700a28bf2930958a300805360e7ee458ba8 libpagemaker-0.0.4.tar.xz https://dev-www.libreoffice.org/src/
[D] 8b1365c2fe1580299694d11185ad4b97dbc6ab70385a306461e7aa75 libqxp-0.0.2.tar.xz https://dev-www.libreoffice.org/src/
[D] fee5036338fb8846c208c4dd07e36948f769b0eeb8ab7608b139ef34 libstaroffice-0.0.7.tar.xz https://dev-www.libreoffice.org/src/
[D] 1365b3f098eec0c210fb3bb9f97771019c6ea91f1d037a47e0ba8014 libvisio-0.1.10.tar.xz https://dev-www.libreoffice.org/src/
[D] 06ada53ce953d23e8b0a155c5272067c26a3e7c2e0dcb00eff7981b2 libwpg-0.3.4.tar.xz https://dev-www.libreoffice.org/src/
[D] 79f8ee095c430d20b1f8acf086d999be6e0c27e152e3ecaa6e873827 libwps-0.4.14.tar.xz https://dev-www.libreoffice.org/src/
[D] f947c0ee28161cbcf4d5cc425a690222b8d197e4701a71886dbb8a94 md4c-release-0.5.2.tar.gz https://dev-www.libreoffice.org/src/
[D] cd0f673c01eef15635f994ec5d90ea51e166b29bbae92b15dfe82772 mythes-1.2.5.tar.xz https://dev-www.libreoffice.org/src/
[D] e8c0dfd74b754d713b187e814578f51497593b99baa2f33da680bc72 pdfium-7471.tar.bz2 https://dev-www.libreoffice.org/src/
[D] f7442a1372336fd92f88ca3ea0981e1f11b7265a5e066d9e3eec0235 phc-winner-argon2-20190702.tar.gz https://dev-www.libreoffice.org/src/
[D] 6cc30d6662237feff6c8ae266884d232b210215a7b51a1d61fa89179 poppler-26.01.0.tar.xz https://dev-www.libreoffice.org/src/
[D] 5e5ac111524437d47640790fcc2c826312fe0b9d0a79a9522d3949aa poppler-data-0.4.12.tar.gz https://dev-www.libreoffice.org/src/
[D] cf5cb37f3d1dbf0064420f1bc993fff2e1f5376c1df68b5b2e80d960 raptor2-2.0.16.tar.gz https://dev-www.libreoffice.org/src/
[D] 0448d8a8deac5b80ac2d30e5efa0db333a5e38fe8ecc78d0d01b9aed skia-m142-f4ed99d2443962782cf5f8b4dd27179f131e7cbe.tar.xz https://dev-www.libreoffice.org/src/
[D] 7a03e336041e860322a4f672fec5318fe5d48646737c9e1d990deae2 xmlsec1-1.3.9.tar.gz https://dev-www.libreoffice.org/src/
[D] 05e313dc44e129a458b36fe2f63792142939a85597a628ea3fa14d21 zstd-1.5.7.tar.gz https://dev-www.libreoffice.org/src/
[D] 27bbd0d1bbf9dea886e4014624c384a3b09359b316a8b205c1f21f7c zxcvbn-c-2.6.tar.gz https://dev-www.libreoffice.org/src/

if [ $prefix_auto = 1 ]; then
	prefix=opt/libreoffice
	set_confopt
fi

ooo_lang='en-US' # de es fr it' #ALL

lo_tarballs() {
	mkdir -p external/tarballs/
	for f in `match_source_file -p . | grep -v libreoffice`; do
		local dl="$f"
		f=${f##*/}
		ln -svf $dl external/tarballs/$f
	done
}
hook_add prepatch 5 lo_tarballs

var_append confopt ' ' --with-vendor="T2"
var_append confopt ' ' --enable-release-build
var_append confopt ' ' "--with-system-gcc --disable-ccache"
[ "$SDECFG_LTO" = 1 ] && var_append confopt ' ' --enable-lto

#var_append confopt ' ' --disable-fetch-external
var_append confopt ' ' "--with-parallelism=$SDECFG_PARALLEL \
--disable-sdremote \
--disable-sdremote-bluetooth \
--disable-gstreamer-1-0 \
--disable-mariadb-sdbc \
--disable-postgresql-sdbc \
--disable-firebird-sdbc \
--disable-ldap \
--disable-cmis \
--disable-gpgmepp \
--disable-scripting-beanshell \
--with-system-jpeg"

pkginstalled apr && var_append confopt ' ' --with-system-apr
pkginstalled boost &&
	var_append confopt ' ' "--with-system-boost --with-boost-libdir=$root$(pkgprefix libdir boost)"
pkginstalled bzip2 && var_append confopt ' ' --with-system-bzip2
pkginstalled cairo && var_append confopt ' ' --with-system-cairo
pkginstalled clucene && var_append confopt ' ' --with-system-clucene
pkginstalled curl && var_append confopt ' ' --with-system-curl
pkginstalled epoxy && var_append confopt ' ' --with-system-epoxy
pkginstalled harfbuzz graphite2 &&
	var_append confopt ' ' '--with-system-harfbuzz --with-system-graphite'
pkginstalled expat && var_append confopt ' ' --with-system-expat
pkginstalled heimdal || var_append confopt ' ' --without-krb5
pkginstalled hunspell && var_append confopt ' ' --with-system-hunspell
pkginstalled icu4c && var_append confopt ' ' --with-system-icu
pkginstalled lcms2 && var_append confopt ' ' --with-system-lcms2
pkginstalled libatomic_ops && var_append confopt ' ' --with-system-libatomic_ops
pkginstalled libcdr && var_append confopt ' ' --with-system-libcdr
pkginstalled libeot && var_append confopt ' ' --with-system-libeot
pkginstalled libfreehand && var_append confopt ' ' --with-system-libfreehand
pkginstalled libmspub && var_append confopt ' ' --with-system-libmspub
pkginstalled libtiff && var_append confopt ' ' --with-system-libtiff
pkginstalled libsndfile && var_append confopt ' ' --with-system-sndfile
pkginstalled libpng && var_append confopt ' ' --with-system-libpng
pkginstalled librevenge && var_append confopt ' ' --with-system-librevenge
pkginstalled libwpd && var_append confopt ' ' --with-system-libwpd
pkginstalled libwebp && var_append confopt ' ' --with-system-libwebp
pkginstalled libxml && var_append confopt ' ' --with-system-libxml
pkginstalled libzmf && var_append confopt ' ' --with-system-libzmf
pkginstalled neon && var_append confopt ' ' --with-system-neon
pkginstalled nss && var_append confopt ' ' --with-system-nss
pkginstalled mdds && var_append confopt ' ' --with-system-mdds
pkginstalled liborcus && var_append confopt ' ' --with-system-orcus
pkginstalled openssl && var_append confopt ' ' --with-system-openssl
pkginstalled sane-backends && var_append confopt ' ' --with-system-sane
pkginstalled serf && var_append confopt ' ' --with-system-serf
pkginstalled startup-notification && var_append confopt ' ' --enable-libsn
pkginstalled xmlsec && var_append confopt ' ' --with-system-xmlsec
pkginstalled zlib && var_append confopt ' ' --with-system-zlib
pkginstalled zxing-cpp && var_append confopt ' ' --with-system-zxing

var_append confopt ' ' --with-docdir=$docdir

# requires some prebuilt .dll or mingw around - for windows registry mangling
var_append confopt ' ' --disable-odk
var_append confopt ' ' --disable-gstreamer-1-0
var_append confopt ' ' --without-java

# UI language
var_append confopt ' ' "'--with-lang=\"\$ooo_lang\"'"
var_append confopt ' ' "'--with-dict=\"\$ooo_lang\"'"

# Widgets and Icons
ooo_iconset=

if pkginstalled openldap; then
	var_append GCC_WRAPPER_APPEND ' ' "-I`pkgprefix includedir openldap`"
	var_append GCC_WRAPPER_APPEND ' ' "-L`pkgprefix libdir openldap`"
else
	var_append confopt ' ' --disable-ldap
fi

var_append confopt ' ' --enable-access=no
var_append confopt ' ' --enable-mono=no

#FIXME: download location [ "$SDECFG_PKG_OOO_ICONS_BLUECURVE" = '1' ] && var_append ooo_iconset ',' Bluecurve
[ -n "$ooo_iconset" ] && var_append confopt ' ' --with-icons=$ooo_iconset

cpu="`echo $arch | arch2uname`"
var_append confopt ' ' --with-arch=$cpu

var_append confopt ' ' "--without-gpc --enable-crashdump=no --disable-crashdump --disable-binfilter --disable-epm"
var_append confopt ' ' "--with-system-db --with-db-version=4.3"
var_append confopt ' ' "--enable-fontconfig --without-myspell-dicts --without-fonts"
var_append confopt ' ' "--disable-mozilla --without-gssapi"

if [[ $libdir == *lib64 ]]; then
	var_append confopt ' ' --enable-64bit-libs=yes
fi

if atstage cross; then
	export PKG_CONFIG_FOR_BUILD=/usr/bin/pkg-config
	# for dconf build artifacts
	export HOME=$builddir/home
	mkdir -p $HOME

	# why don't have cross compiling python, and skia needs clang :-/
	var_append confopt ' ' '--enable-python=no --disable-skia'

	# TODO: better, for arm64 crypto:
	var_remove_regex GCC_WRAPPER_INSERT ' ' '-march=.*'
	var_remove GCC_WRAPPER_REMOVE ' ' '-march*'

	# don't overwrite it's internal CC vs. HOSTCC defines
	var_remove_regex makeopt ' ' '[A-Z].*=.*'
fi

var_append confopt ' ' "--x-includes=$root$(pkgprefix includedir libx11)"
var_append confopt ' ' "--x-libraries=$root$(pkgprefix libdir libx11)"
var_append GCC_WRAPPER_APPEND ' ' "-I$root$(pkgprefix includedir libx11)"
var_append GCC_WRAPPER_APPEND ' ' "-c?:-L$root$(pkgprefix libdir libx11)"

var_append makeopt ' ' build
atstage native && var_append makeinstopt ' ' DESTDIR=/
makeinstopt="${makeinstopt/install/distro-pack-install}"
