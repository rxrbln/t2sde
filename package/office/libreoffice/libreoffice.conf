# --- T2-COPYRIGHT-NOTE-BEGIN ---
# This copyright note is auto-generated by scripts/Create-CopyPatch.
# 
# T2 SDE: package/*/libreoffice/libreoffice.conf
# Copyright (C) 2004 - 2021 The T2 SDE Project
# 
# More information can be found in the files COPYING and README.
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; version 2 of the License. A copy of the
# GNU General Public License can be found in the file COPYING.
# --- T2-COPYRIGHT-NOTE-END ---

if [ $prefix_auto = 1 ]; then
	prefix=/opt/openoffice.org
	set_confopt
fi

ooo_lang='en-US de es fr it' #ALL

############################################################################
# ooo-build configuration options

var_append confopt ' ' '--with-binsuffix=no' # just one OpenOffice for now
var_append confopt ' ' '--with-installed-ooo-dirname=openoffice.org'
var_append confopt ' ' "--with-docdir=$docdir"

var_append confopt ' ' '--disable-post-install-scripts'
var_append confopt ' ' '--disable-binfilter'
# requires some prebuilt .dll or mingw around - for windows registry mangling
var_append confopt ' ' '--disable-odk'

# instead of --with-internal-gcc
var_append confopt ' ' "--with-system-gcc"

# UI language
var_append confopt ' ' "'--with-lang=\"\$ooo_lang\"'"
var_append confopt ' ' "'--with-dict=\"\$ooo_lang\"'"

# Widgets and Icons
#
ooo_iconset=

# GNOME support
if pkginstalled gtk+2; then
	var_append confopt ' ' "--enable-gtk"
	if pkginstalled libbonobo; then
		var_append confopt ' ' "--with-bonobo"
	fi
	[ "$SDECFG_PKG_OOO_ICONS_GNOME" = "1" ] &&
		var_append ooo_iconset ',' "gnome"
else
	var_append confopt ' ' "--disable-gtk"
fi

var_append confopt ' ' "--disable-kde"

if ! pkginstalled gnome-vfs; then
	var_append confopt ' ' '--disable-gnome-vfs'
fi

if pkginstalled openldap; then
	var_append GCC_WRAPPER_APPEND ' ' "-I`pkgprefix includedir openldap`"
	var_append GCC_WRAPPER_APPEND ' ' "-L`pkgprefix libdir openldap`"
else
	var_append confopt ' ' '--disable-ldap'
fi

# disable cairo support, for now
var_append confopt ' ' "--enable-cairo=no"
# disable mdb/access support, for now
var_append confopt ' ' "--enable-access=no"
# disable mono support, for now
var_append confopt ' ' "--enable-mono=no"

#FIXME: download location [ "$SDECFG_PKG_OOO_ICONS_BLUECURVE" = "1" ] && var_append ooo_iconset ',' "Bluecurve"
[ -n "$ooo_iconset" ] && var_append confopt ' ' "--with-icons=$ooo_iconset"

# Architecture
cpu="`echo $arch | arch2uname`"
var_append confopt ' ' "--with-arch=$cpu"

# some steps of the build are a serious memory hog, so don't parallelize this build
#if [ "$SDECFG_PARALLEL_MAX" ] && [ $SDECFG_PARALLEL_MAX -gt 1 ]; then
#	var_append makeopt ' ' "MAXPROCESS='$SDECFG_PARALLEL_MAX'"
#fi

var_append confopt ' ' "--without-gpc --enable-crashdump=no --disable-crashdump --disable-binfilter --disable-epm"

var_append confopt ' ' "--with-system-db --with-db-version=4.3"

var_append confopt ' ' "--enable-fontconfig --without-myspell-dicts --without-fonts"
var_append confopt ' ' "--disable-mozilla --without-gssapi"

# build fails otherwise
var_append confopt ' ' "--enable-vba --with-vba-package-format=builtin"

pkginstalled boost && var_append confopt ' ' "--with-system-boost"
pkginstalled heimdal || var_append confopt ' ' "--without-krb5"

pkginstalled startup-notification && var_append confopt ' ' "--enable-libsn"

pkginstalled libsndfile && var_append confopt ' ' "--with-system-sndfile"

if pkginstalled nas; then
       	var_append confopt ' ' "--with-system-nas"
	export LDFLAGS=-L`pkgprefix libdir libx11`
	export CFLAGS=-I/usr/X11/include
	export CPPFLAGS=-I/usr/X11/include
else
	var_append confopt ' ' "--without-nas"
fi

if [[ $libdir == *lib64 ]]; then
	var_append confopt ' '  "--enable-64bit-libs=yes"
fi

# Java support
var_append confopt ' ' "--without-java"

var_append GCC_WRAPPER_APPEND ' ' "`pkg-config --cflags --libs-only-L x11`"
