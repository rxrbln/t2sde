#!/bin/sh
# --- T2-COPYRIGHT-NOTE-BEGIN ---
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# 
# T2 SDE: package/.../ooo/ooo.conf
# Copyright (C) 2004 - 2005 The T2 SDE Project
# 
# More information can be found in the files COPYING and README.
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; version 2 of the License. A copy of the
# GNU General Public License can be found in the file COPYING.
# --- T2-COPYRIGHT-NOTE-END ---

if [ $prefix_auto = 1 ] ; then
	prefix=/opt/ooo
	set_confopt
fi

############################################################################
# Ximian build system configuration options

var_append confopt ' ' "--with-installed-ooo-dirname=OpenOffice.org"

# src680-mXX
var_append confopt ' ' "--with-tag=src680-${ver##${ver:0:3}-}"

# populate src/ with every [D] on our .desc
# (instead of --with-srcdir)
#
hook_add prepatch 5 'ooo_populate_src'
ooo_populate_src() {
	for i in `match_source_file -p .`; do
		ln -svf $i src/
	done
	tar xvf src/hyph-1.tar -C src/
	tar xvf src/thes-1.tar -C src/
}

# instead of --with-internal-gcc
var_append confopt ' ' "--with-system-gcc"

# yes, we are ourselves
var_append confopt ' ' "--with-distro=T2" 
var_append confopt ' ' "--with-vendor=T2"

var_append confopt ' ' "--with-lang=en-US" # ALL broke during install

# development versions do not seem to include the language packs ...
export DEFAULT_TO_ENGLISH_FOR_PACKING="yes"

# Widgets and Icons
#
ooo_iconset=

# GNOME support
if pkginstalled gtk+; then
	# [ "$SDECFG_PKG_OOO_WIDGETS" = "gnome" ]
	var_append confopt ' ' "--enable-gtk"
	if pkginstalled libbonobo; then
		#[ "$SDECFG_PKG_OOO_BONOBO" = "1" ]
		var_append confopt ' ' "--with-bonobo"
	fi
	[ "$SDECFG_PKG_OOO_ICONS_GNOME" = "1" ] &&
		var_append ooo_iconset ',' "gnome"
else
	var_append confopt ' ' "--disable-gtk"
fi

# KDE support
if pkginstalled arts; then
	# [ "$SDECFG_PKG_OOO_WIDGETS" = "kde" ]
	var_append confopt ' ' "--enable-kde"
	[ "$SDECFG_PKG_OOO_ICONS_KDE" = "1" ] &&
		var_append ooo_iconset ',' "kde"

	export QTLIB=$QTDIR/lib
else
	var_append confopt ' ' "--disable-kde"
fi

#FIXME: download location [ "$SDECFG_PKG_OOO_ICONS_BLUECURVE" = "1" ] && var_append ooo_iconset ',' "Bluecurve"
[ -n "$ooo_iconset" ] && var_append confopt ' ' "--with-icons=$ooo_iconset"


# Java support
#
if pkginstalled blackdown-jdk && pkginstalled apache-ant; then
	var_append confopt ' ' "--enable-java"
	var_append confopt ' ' "--with-jdk-home=$root/$JAVA_HOME"
	#var_append oooconfopt ' ' "--with-ant-home=/usr"
else
	var_append confopt ' ' "--disable-java"
	#var_append oooconfopt ' ' "--disable-java"
fi

#Additional documentation
# TODO: CONFIG
var_append confopt ' ' "--with-docdir=$docdir"

# GCC
# NOTE: we patch gcc33 support to use what jsaw wanted :)
var_append confopt ' ' "--enable-gcc33"

# Architecture
cpu="`echo "$arch_machine" | sed -e s/i.86/i386/ -e s/powerpc/ppc/`"
var_append confopt ' ' "--with-arch=$cpu"

hook_add preconf 5 'ooo_preconfigure'
ooo_preconfigure() {
	# i don't want this common config, at least for now -mnemoc
	cat /dev/null > distro-configs/Common.conf.in

	# fixed config
	cat <<-EOT > distro-configs/T2.conf
	--without-gpc
	--enable-crashdump=no
	--disable-crashdump
	--disable-binfilter
	--disable-epm

	--with-system-gcc
	--with-system-zlib
	--with-system-freetype
	--with-system-expat
	--with-system-neon
	--with-system-curl
	--with-system-jpeg
	--with-system-libxml
	--with-system-python

	--with-system-db
	--with-db-version=4.2

	--enable-fontconfig
	--without-myspell-dicts
	--without-fonts

	--with-lang=en-US
	--with-dict=en-US

	EOT

	# conditional config
	{
	pkginstalled mozilla &&
		echo "--with-system-mozilla"

	pkginstalled libart_lgpl23 &&
		echo "--enable-libart"

	pkginstalled startup-notification &&
		echo "--enable-libsn"

	if pkginstalled nas; then
	       	echo "--with-system-nas"
		export LDFLAGS=-L/usr/X11/lib
		export CFLAGS=-I/usr/X11/include
		export CPPFLAGS=-I/usr/X11/include
	fi
	} >> distro-configs/T2.conf

	cp distro-configs/T2{,64}.conf
}

