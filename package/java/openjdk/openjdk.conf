# --- T2-COPYRIGHT-NOTE-BEGIN ---
# T2 SDE: package/*/openjdk/openjdk.conf
# Copyright (C) 2022 - 2024 The T2 SDE Project
# 
# This Copyright note is generated by scripts/Create-CopyPatch,
# more information can be found in the files COPYING and README.
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License version 2.
# --- T2-COPYRIGHT-NOTE-END ---

prepare() {
	chmod +x configure
	if ! which java; then
		echo 'Extracting bootstrap JDK...'
		tar -xf ../archdir/OpenJDK-*-bin.tar.*
		var_append PATH ':' "$PWD/OpenJDK-*-bin/bin"
		export PATH
	fi
}

install() {
	mkdir -pv $root/opt/java/
	cp -Rv build/*/images/jdk/* /opt/java/
}

# Additional configure options
var_append extraconfopt ' ' '--enable-unlimited-crypto'
var_append extraconfopt ' ' '--disable-warnings-as-errors'
var_append extraconfopt ' ' '--with-stdc++lib=dynamic'
for lib in giflib lcms libjpeg libpng zlib; do
	var_append extraconfopt ' ' "--with-$lib=system"
done

var_append confopt ' ' "--with-x=$root/$SDECFG_PKG_X11_PREFIX"
var_append extraconfopt ' ' "--with-fontconfig=$root/$SDECFG_PKG_X11_PREFIX"

# Do confopt cleaning manually, since automatic cleaning is broken
var_remove extraconfopt ' ' "--with-pam"
var_remove extraconfopt ' ' "--with-libpam"
var_remove extraconfopt ' ' "--enable-pam"
var_remove extraconfopt ' ' "--enable-libpam"

# Replace -jN with JOBS=N and add images target
var_remove makeopt ' ' "-j$SDECFG_PARALLEL_MAX"
var_insert makeopt ' ' "JOBS=$SDECFG_PARALLEL_MAX"
var_append makeopt ' ' 'images'

hook_add preconf 2 prepare
hook_add postmake 2 install

makeinstopt=
cleanconfopt=0
autogen=0
