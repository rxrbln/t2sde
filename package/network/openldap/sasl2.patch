# --- T2-COPYRIGHT-NOTE-BEGIN ---
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# 
# T2 SDE: package/.../openldap/sasl2.patch
# Copyright (C) 2004 - 2005 The T2 SDE Project
# 
# More information can be found in the files COPYING and README.
# 
# This patch file is dual-licensed. It is available under the license the
# patched project is licensed under, as long as it is an OpenSource license
# as defined at http://www.opensource.org/ (e.g. BSD, X11) or under the terms
# of the GNU General Public License as published by the Free Software
# Foundation; either version 2 of the License, or (at your option) any later
# version.
# --- T2-COPYRIGHT-NOTE-END ---
diff -Nur openldap-2.3.11.orig/build/openldap.m4 openldap-2.3.11/build/openldap.m4
--- openldap-2.3.11.orig/build/openldap.m4	2005-09-28 03:30:28.000000000 +0300
+++ openldap-2.3.11/build/openldap.m4	2005-10-13 18:50:25.000000000 +0300
@@ -1219,8 +1219,8 @@
 AC_DEFUN([OL_SASL_COMPAT],
 [AC_CACHE_CHECK([Cyrus SASL library version], [ol_cv_sasl_compat],[
 	AC_EGREP_CPP(__sasl_compat,[
-#ifdef HAVE_SASL_SASL_H
-#include <sasl/sasl.h>
+#ifdef HAVE_SASL2_SASL_H
+#include <sasl2/sasl.h>
 #else
 #include <sasl.h>
 #endif
diff -Nur openldap-2.3.11.orig/clients/tools/common.c openldap-2.3.11/clients/tools/common.c
--- openldap-2.3.11.orig/clients/tools/common.c	2005-08-09 19:41:26.000000000 +0300
+++ openldap-2.3.11/clients/tools/common.c	2005-10-13 19:32:40.000000000 +0300
@@ -33,8 +33,8 @@
 #include <ac/errno.h>
 
 #ifdef HAVE_CYRUS_SASL
-#ifdef HAVE_SASL_SASL_H
-#include <sasl/sasl.h>
+#ifdef HAVE_SASL2_SASL_H
+#include <sasl2/sasl.h>
 #else
 #include <sasl.h>
 #endif
diff -Nur openldap-2.3.11.orig/configure openldap-2.3.11/configure
--- openldap-2.3.11.orig/configure	2005-10-05 21:41:09.000000000 +0300
+++ openldap-2.3.11/configure	2005-10-13 19:25:51.000000000 +0300
@@ -35084,7 +35084,7 @@
 if test $ol_with_cyrus_sasl != no ; then
 
 
-for ac_header in sasl/sasl.h sasl.h
+for ac_header in sasl2/sasl.h sasl.h
 do
 as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
@@ -35234,7 +35234,7 @@
 done
 
 
-	if test $ac_cv_header_sasl_sasl_h = yes ||
+	if test $ac_cv_header_sasl2_sasl_h = yes ||
 	   test $ac_cv_header_sasl_h = yes; then
 		echo "$as_me:$LINENO: checking for sasl_client_init in -lsasl2" >&5
 echo $ECHO_N "checking for sasl_client_init in -lsasl2... $ECHO_C" >&6
@@ -35404,8 +35404,8 @@
 cat >>conftest.$ac_ext <<_ACEOF
 /* end confdefs.h.  */
 
-#ifdef HAVE_SASL_SASL_H
-#include <sasl/sasl.h>
+#ifdef HAVE_SASL2_SASL_H
+#include <sasl2/sasl.h>
 #else
 #include <sasl.h>
 #endif
diff -Nur openldap-2.3.11.orig/configure.in openldap-2.3.11/configure.in
--- openldap-2.3.11.orig/configure.in	2005-09-28 03:30:27.000000000 +0300
+++ openldap-2.3.11/configure.in	2005-10-13 19:26:44.000000000 +0300
@@ -2180,9 +2180,9 @@
 ol_link_sasl=no
 ol_link_spasswd=no
 if test $ol_with_cyrus_sasl != no ; then
-	AC_CHECK_HEADERS(sasl/sasl.h sasl.h)
+	AC_CHECK_HEADERS(sasl2/sasl.h sasl.h)
 
-	if test $ac_cv_header_sasl_sasl_h = yes ||
+	if test $ac_cv_header_sasl2_sasl_h = yes ||
 	   test $ac_cv_header_sasl_h = yes; then
 		AC_CHECK_LIB(sasl2, sasl_client_init,
 			[ol_link_sasl="-lsasl2"],
diff -Nur openldap-2.3.11.orig/include/portable.hin openldap-2.3.11/include/portable.hin
--- openldap-2.3.11.orig/include/portable.hin	2005-09-01 23:28:10.000000000 +0300
+++ openldap-2.3.11/include/portable.hin	2005-10-13 19:28:32.000000000 +0300
@@ -514,8 +514,8 @@
 /* Define to 1 if you have the <sasl.h> header file. */
 #undef HAVE_SASL_H
 
-/* Define to 1 if you have the <sasl/sasl.h> header file. */
-#undef HAVE_SASL_SASL_H
+/* Define to 1 if you have the <sasl2/sasl.h> header file. */
+#undef HAVE_SASL2_SASL_H
 
 /* define if your SASL library has sasl_version() */
 #undef HAVE_SASL_VERSION
diff -Nur openldap-2.3.11.orig/libraries/libldap/cyrus.c openldap-2.3.11/libraries/libldap/cyrus.c
--- openldap-2.3.11.orig/libraries/libldap/cyrus.c	2005-10-05 20:42:19.000000000 +0300
+++ openldap-2.3.11/libraries/libldap/cyrus.c	2005-10-13 18:57:39.000000000 +0300
@@ -45,8 +45,8 @@
 ldap_pvt_thread_mutex_t ldap_int_sasl_mutex;
 #endif
 
-#ifdef HAVE_SASL_SASL_H
-#include <sasl/sasl.h>
+#ifdef HAVE_SASL2_SASL_H
+#include <sasl2/sasl.h>
 #else
 #include <sasl.h>
 #endif
diff -Nur openldap-2.3.11.orig/libraries/libldap/ldap-int.h openldap-2.3.11/libraries/libldap/ldap-int.h
--- openldap-2.3.11.orig/libraries/libldap/ldap-int.h	2005-10-12 04:10:47.000000000 +0300
+++ openldap-2.3.11/libraries/libldap/ldap-int.h	2005-10-13 18:57:59.000000000 +0300
@@ -32,8 +32,8 @@
 
 #ifdef HAVE_CYRUS_SASL
 	/* the need for this should be removed */
-#ifdef HAVE_SASL_SASL_H
-#include <sasl/sasl.h>
+#ifdef HAVE_SASL2_SASL_H
+#include <sasl2/sasl.h>
 #else
 #include <sasl.h>
 #endif
diff -Nur openldap-2.3.11.orig/libraries/liblutil/sasl.c openldap-2.3.11/libraries/liblutil/sasl.c
--- openldap-2.3.11.orig/libraries/liblutil/sasl.c	2005-01-20 20:03:52.000000000 +0200
+++ openldap-2.3.11/libraries/liblutil/sasl.c	2005-10-13 18:59:02.000000000 +0300
@@ -22,8 +22,8 @@
 #include <ac/string.h>
 #include <ac/unistd.h>
 
-#ifdef HAVE_SASL_SASL_H
-#include <sasl/sasl.h>
+#ifdef HAVE_SASL2_SASL_H
+#include <sasl2/sasl.h>
 #else
 #include <sasl.h>
 #endif
diff -Nur openldap-2.3.11.orig/servers/slapd/sasl.c openldap-2.3.11/servers/slapd/sasl.c
--- openldap-2.3.11.orig/servers/slapd/sasl.c	2005-08-19 21:09:04.000000000 +0300
+++ openldap-2.3.11/servers/slapd/sasl.c	2005-10-13 19:00:08.000000000 +0300
@@ -29,15 +29,15 @@
 #include "slap.h"
 
 #ifdef HAVE_CYRUS_SASL
-# ifdef HAVE_SASL_SASL_H
-#  include <sasl/sasl.h>
+# ifdef HAVE_SASL2_SASL_H
+#  include <sasl2/sasl.h>
 # else
 #  include <sasl.h>
 # endif
 
 # if SASL_VERSION_MAJOR >= 2
-# ifdef HAVE_SASL_SASL_H
-#  include <sasl/saslplug.h>
+# ifdef HAVE_SASL2_SASL_H
+#  include <sasl2/saslplug.h>
 # else
 #  include <saslplug.h>
 # endif
