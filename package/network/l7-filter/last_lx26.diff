--- ./kernel-2.6-layer7-1.0.patch.orig	2005-03-09 17:54:06.272347280 -0300
+++ ./kernel-2.6-layer7-1.0.patch	2005-03-09 17:58:44.443058904 -0300
@@ -99,9 +99,9 @@
 diff -Nurp linux-2.6.10-stock/net/ipv4/netfilter/ip_conntrack_core.c linux-2.6.10-layer7-clean/net/ipv4/netfilter/ip_conntrack_core.c
 --- linux-2.6.10-stock/net/ipv4/netfilter/ip_conntrack_core.c	2004-12-24 15:33:47.000000000 -0600
 +++ linux-2.6.10-layer7-clean/net/ipv4/netfilter/ip_conntrack_core.c	2005-01-07 13:26:59.000000000 -0600
-@@ -302,6 +302,14 @@ destroy_conntrack(struct nf_conntrack *n
- 	if (ct->expecting)
- 		remove_expectations(ct, 1);
+@@ -253,6 +253,14 @@
+ 		list_del(&ct->tuplehash[IP_CT_DIR_ORIGINAL].list);
+ 	}
  
 +        #if defined(CONFIG_IP_NF_MATCH_LAYER7) || defined(CONFIG_IP_NF_MATCH_LAYER7_MODULE)
 +        /* This ought to get free'd somewhere.  How about here? */
@@ -111,9 +111,9 @@
 +                kfree(ct->layer7.app_data);
 +        #endif
 +
- 	/* Delete our master expectation */
- 	if (ct->master) {
- 		if (ct->master->expectant) {
+ 	CONNTRACK_STAT_INC(delete);
+ 	WRITE_UNLOCK(&ip_conntrack_lock);
+ 
 diff -Nurp linux-2.6.10-stock/net/ipv4/netfilter/ip_conntrack_standalone.c linux-2.6.10-layer7-clean/net/ipv4/netfilter/ip_conntrack_standalone.c
 --- linux-2.6.10-stock/net/ipv4/netfilter/ip_conntrack_standalone.c	2004-12-24 15:34:33.000000000 -0600
 +++ linux-2.6.10-layer7-clean/net/ipv4/netfilter/ip_conntrack_standalone.c	2005-01-07 13:26:59.000000000 -0600
