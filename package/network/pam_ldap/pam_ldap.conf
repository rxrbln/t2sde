# --- T2-COPYRIGHT-NOTE-BEGIN ---
# T2 SDE: package/*/pam_ldap/pam_ldap.conf
# Copyright (C) 2004 - 2021 The T2 SDE Project
# Copyright (C) 1998 - 2004 ROCK Linux Project
# 
# This Copyright note is generated by scripts/Create-CopyPatch,
# more information can be found in the files COPYING and README.
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License version 2.
# --- T2-COPYRIGHT-NOTE-END ---

if [ "$prefix_auto" = 1 ]; then
	prefix=
	set_confopt
fi

pkgprefix -t openldap

var_append confopt ' ' "--with-ldap-dir=$root/`pkgprefix openldap`"
var_append confopt ' ' "--with-ldap-conf-file=$root`pkgprefix sysconfdir openldap`/ldap.conf"
var_append confopt ' ' "--with-ldap-secret-file=$root`pkgprefix sysconfdir openldap`/ldap.secret"

hook_add postmake 3 "cp -avP pam.d $root$docdir/"
hook_add postpatch 5 'mv -v chfn chfn.in; mv -v chsh chsh.in'

# 64bit libdir fix
fix64_pam_ldap() {
	sed -i "s,with_ldap_dir[/]lib,with_ldap_dir/${libdir##*/},g" configure.in
	aclocal; autoconf
}
[[ $libdir = *lib64 ]] && hook_add preconf 5 fix64_pam_ldap
