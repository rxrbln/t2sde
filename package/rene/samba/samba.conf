# --- ROCK-COPYRIGHT-NOTE-BEGIN ---
# 
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# Please add additional copyright information _after_ the line containing
# the ROCK-COPYRIGHT-NOTE-END tag. Otherwise it might get removed by
# the ./scripts/Create-CopyPatch script. Do not edit this copyright text!
# 
# ROCK Linux: rock-src/package/rene/samba/samba.conf
# ROCK Linux is Copyright (C) 1998 - 2003 Clifford Wolf
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version. A copy of the GNU General Public
# License can be found at Documentation/COPYING.
# 
# Many people helped and are helping developing ROCK Linux. Please
# have a look at http://www.rocklinux.org/ and the Documentation/TEAM
# file for details.
# 
# --- ROCK-COPYRIGHT-NOTE-END ---

main() {

extraconfopt="--with-smbmount --with-automount \
	 --with-syslog \
         --with-configdir=$sysconfdir \
	 --with-privatedir=$sysconfdir/private \
	 --with-codepagedir=$sysconfdir/codepages \
         --with-swatdir=$root/$prefix/share/swat \
         --with-quotas \
         --with-fhs \
         --with-utmp \
         --with-ssl \
	 --with-msdfs \
	 --with-acl-support \
         --with-libsmbclient \
	 --with-spinlocks"

eval ./configure $confopt $extraconfopt

eval $MAKE ; eval $MAKE install

#the smbadduser-script must get modified
cp script/smbadduser $bindir
cd ..
cp -r docs $docdir
cp -r examples $docdir
cp -r pcp $docdir
cp -r testsuite $docdir

sed 's/;  encrypt passwords = yes/  encrypt passwords = yes/' examples/smb.conf.default > smb.conf
mv -f smb.conf $sysconfdir

cat >$sysconfdir/lmhosts<<'EOS'
# ROCK Linux: Samba lmhosts
#
# This file contains host maps for NetBIOS
# It is similar to the /etc/hosts file format
# See lmhosts (5) for more info.
#
# Format is:
# 0.0.0.0 NetBIOS_Name

EOS

#copy simple versions of init-scripts 
install -m 755 $confdir/samba.init $root/etc/rc.d/init.d/samba
install -m 755 $confdir/smbmount.init $root/etc/rc.d/init.d/smbmount

##printcap smbclient filter
#cp /opt/samba/share/doc/examples/printing/smbprint.sysv /opt/samba/bin/smbprint
#chmod 755 /opt/samba/bin/smbprint

}

srcdir=samba-$ver/source
custmain=main

