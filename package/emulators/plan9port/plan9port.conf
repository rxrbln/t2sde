# --- T2-COPYRIGHT-NOTE-BEGIN ---
# This copyright note is auto-generated by scripts/Create-CopyPatch.
# 
# T2 SDE: package/*/plan9port/plan9port.conf
# Copyright (C) 2021 The T2 SDE Project
# 
# More information can be found in the files COPYING and README.
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; version 2 of the License. A copy of the
# GNU General Public License can be found in the file COPYING.
# --- T2-COPYRIGHT-NOTE-END ---

configure() {
	var_append CPPFLAGS ' ' "-I$root$includedir/freetype2"
	var_append CPPFLAGS ' ' '-Wno-sizeof-array-div'
	var_append CPPFLAGS ' ' '-Wno-array-parameter'
	var_append LDFLAGS ' ' "-L$root/$prefix/X11R7/lib64"

	var_append CC9FLAGS ' ' "$CFLAGS"
	var_append CC9FLAGS ' ' "$CPPFLAGS"
	echo "CC9FLAGS='$CC9FLAGS'" >> LOCAL.config
	echo "CC9='$CC'" >> LOCAL.config
	echo "LDFLAGS='$LDFLAGS'" >> LOCAL.config
}

build() {
	./INSTALL -r $root/$prefix/plan9port | tee install.log
	fgrep 'exit status=exit(1)' install.log >/dev/null && exit 1
	true
}

install() {
	rm -rf src/
	cp -rv . $root/$prefix/plan9port/ || exit 1
	ln -sf $root/$prefix/plan9port/bin/9 $root$bindir/9 || exit 1
	echo "export PLAN9=/$prefix/plan9port" > $root$sysconfdir/profile.d/plan9port
}

runconf=0
makeopt=
makeinstopt=

hook_add premake 2 configure
hook_add inmake 2 build
hook_add postmake 2 install
