# --- T2-COPYRIGHT-NOTE-BEGIN ---
# This copyright note is auto-generated by scripts/Create-CopyPatch.
# 
# T2 SDE: package/*/qemu/qemu.conf
# Copyright (C) 2004 - 2021 The T2 SDE Project
# 
# More information can be found in the files COPYING and README.
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; version 2 of the License. A copy of the
# GNU General Public License can be found in the file COPYING.
# --- T2-COPYRIGHT-NOTE-END ---

runmeson=0

var_remove_regex confopt ' ' '--host=.*'
var_remove_regex makeopt ' ' 'CPP=.*'; unset CPP

if atstage cross then; then
	export PKG_CONFIG=pkg-config
	var_append extraconfopt ' ' "--cross-prefix=$arch_target-"
fi

if [ "$SDECFG_PKG_QEMU_ALL" = 0 ]; then
	qemu_arch=$(echo $arch_machine | arch2uname)
	qemu_arch=${qemu_arch/i?86/i386}
	var_append extraconfopt ' ' \
		"--target-list=$qemu_arch-softmmu,$qemu_arch-linux-user"
fi

var_append GCC_WRAPPER_INSERT ' ' "-c?:-L`pkgprefix libdir glib`"
# does not correctly locate libX11 itself
pkginstalled libx11 && var_append GCC_WRAPPER_INSERT ' ' "-c?:-L`pkgprefix libdir libx11`"
pkginstalled virglrenderer && var_append GCC_WRAPPER_INSERT ' ' "-I`pkgprefix includedir virglrenderer`"
pkginstalled alsa-lib && var_append extraconfopt ' ' '--audio-drv-list=alsa'
