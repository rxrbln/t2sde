# --- T2-COPYRIGHT-NOTE-BEGIN ---
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# 
# T2 SDE: package/.../findutils/compile.patch.dietlibc
# Copyright (C) 2004 - 2016 The T2 SDE Project
# Copyright (C) 1998 - 2004 ROCK Linux Project
# 
# More information can be found in the files COPYING and README.
# 
# This patch file is dual-licensed. It is available under the license the
# patched project is licensed under, as long as it is an OpenSource license
# as defined at http://www.opensource.org/ (e.g. BSD, X11) or under the terms
# of the GNU General Public License as published by the Free Software
# Foundation; either version 2 of the License, or (at your option) any later
# version.
# --- T2-COPYRIGHT-NOTE-END ---

The getline stuff should be made in a more clean way ... perhups it will be
then upstreamable ... who knows ;)

putw and getw could also be put in a __dietlibc__ conditional ...

--- ./locate/code.c.orig	2005-06-07 18:18:41.000000000 -0400
+++ ./locate/code.c	2005-10-31 13:37:17.000000000 -0300
@@ -210,7 +210,11 @@
       if (diffcount < -LOCATEDB_OLD_OFFSET || diffcount > LOCATEDB_OLD_OFFSET)
 	{
 	  putc (LOCATEDB_OLD_ESCAPE, stdout);
-	  putw (diffcount + LOCATEDB_OLD_OFFSET, stdout);
+	  {
+	    int a = diffcount + LOCATEDB_OLD_OFFSET;
+	    fwrite(&a,sizeof(a),1,stdout);
+	  }
+//	  putw (diffcount + LOCATEDB_OLD_OFFSET, stdout);
 	}
       else
 	putc (diffcount + LOCATEDB_OLD_OFFSET, stdout);
--- ./locate/locate.c.orig	2005-06-12 17:25:31.000000000 -0400
+++ ./locate/locate.c	2005-10-31 15:25:35.000000000 -0300
@@ -475,7 +475,11 @@
 
   /* Get the offset in the path where this path info starts.  */
   if (procdata->c == LOCATEDB_OLD_ESCAPE)
-    procdata->count += getw (procdata->fp) - LOCATEDB_OLD_OFFSET;
+    {
+    int a;
+    fread(&a,sizeof(a),1,procdata->fp);
+    procdata->count += a - LOCATEDB_OLD_OFFSET;
+    }
   else
     procdata->count += procdata->c - LOCATEDB_OLD_OFFSET;
 
--- ./gnulib/lib/getline.c.orig	2005-05-17 04:41:00.000000000 -0400
+++ ./gnulib/lib/getline.c	2005-10-31 15:26:27.000000000 -0300
@@ -25,6 +25,7 @@
 
 #include "getline.h"
 
+#if 0
 #if ! (defined __GNU_LIBRARY__ && HAVE_GETDELIM)
 
 # include "getndelim2.h"
@@ -36,6 +37,7 @@
                      stream);
 }
 #endif
+#endif
 
 ssize_t
 getline (char **lineptr, size_t *linesize, FILE *stream)
--- ./gnulib/lib/getline.h.orig	2005-05-17 04:41:00.000000000 -0400
+++ ./gnulib/lib/getline.h	2005-10-31 15:27:00.000000000 -0300
@@ -29,10 +29,12 @@
 /* glibc2 has these functions declared in <stdio.h>.  Avoid redeclarations.  */
 # if __GLIBC__ < 2
 
+/*
 extern ssize_t getline (char **_lineptr, size_t *_linesize, FILE *_stream);
 
 extern ssize_t getdelim (char **_lineptr, size_t *_linesize, int _delimiter,
 			  FILE *_stream);
+*/
 
 # endif
 
