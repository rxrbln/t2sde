# --- T2-COPYRIGHT-NOTE-BEGIN ---
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# 
# T2 SDE: package/.../sysfiles/parse-config
# Copyright (C) 2004 - 2005 The T2 SDE Project
# Copyright (C) 1998 - 2003 ROCK Linux Project
# 
# More information can be found in the files COPYING and README.
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; version 2 of the License. A copy of the
# GNU General Public License can be found in the file COPYING.
# --- T2-COPYRIGHT-NOTE-END ---


if [ "$pkg" != "sysfiles" ]; then
	var_append flistdel "|" "etc/mtab"
fi

if [ -f $confdir/postsysfiles.in -a $stagelevel -gt 1 ] ; then
	var_append flistdel "|" "etc/passwd"
	var_append flistdel "|" "etc/shadow"
	var_append flistdel "|" "etc/gshadow"
	hook_add preconf 2 ". $confdir/postsysfiles.in"
fi

# Usage: safe_useradd name uid gid desc homedir shell pass
#
#	uid and name must be registered in
#	Documentation/Developers/REGISTER
#
#	pass is already encrypted and might be one of:
#	"*" ... system account, wont ever have a password
#	"!" ... real user, admin needs to define a password later
#
safe_useradd() {
	if grep -q "^$1:" $root/etc/passwd; then
		echo "Found already existing user '$1'."
	else
		echo "Creating user '$1' ..."
		echo "$1:x:$2:$3:$4:$5:$6" >> $root/etc/passwd
		echo "$1:$7:::::::" >> $root/etc/shadow
	fi
}

# Usage: safe_groupadd name id
#
#	gid and name must be registered in
#	Documentation/Developers/REGISTER
#
safe_groupadd() {
	if grep -q "^$1:" $root/etc/group; then
		echo "Found already existing group '$1'."
	else
		echo "Creating group '$1' ..."
		echo "$1:x:$2:" >> $root/etc/group
	fi
}

