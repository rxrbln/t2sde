# --- ROCK-COPYRIGHT-NOTE-BEGIN ---
# 
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# Please add additional copyright information _after_ the line containing
# the ROCK-COPYRIGHT-NOTE-END tag. Otherwise it might get removed by
# the ./scripts/Create-CopyPatch script. Do not edit this copyright text!
# 
# ROCK Linux: rock-src/package/base/sysfiles/parse-config
# ROCK Linux is Copyright (C) 1998 - 2003 Clifford Wolf
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version. A copy of the GNU General Public
# License can be found at Documentation/COPYING.
# 
# Many people helped and are helping developing ROCK Linux. Please
# have a look at http://www.rocklinux.org/ and the Documentation/TEAM
# file for details.
# 
# --- ROCK-COPYRIGHT-NOTE-END ---


if [ "$pkg" != "sysfiles" ]; then
	var_append flistdel "|" "etc/mtab"
fi

if [ -f $confdir/postsysfiles.in -a $stagelevel -gt 1 ] ; then
	var_append flistdel "|" "etc/passwd"
	var_append flistdel "|" "etc/shadow"
	var_append flistdel "|" "etc/gshadow"
	hook_add preconf 2 ". $confdir/postsysfiles.in"
fi

# Usage: safe_useradd name uid gid desc homedir shell pass
#
#	uid and name must be registered in
#	Documentation/Developers/REGISTER
#
#	pass is already encrypted and might be one of:
#	"*" ... system account, wont ever have a password
#	"!" ... real user, admin needs to define a password later
#
safe_useradd() {
	if grep -q "^$1:" $root/etc/passwd; then
		echo "Found already existing user '$1'."
	else
		echo "Creating user '$1' ..."
		echo "$1:x:$2:$3:$4:$5:$6" >> $root/etc/passwd
		echo "$1:$7:::::::" >> $root/etc/shadow
	fi
}

# Usage: safe_groupadd name id
#
#	gid and name must be registered in
#	Documentation/Developers/REGISTER
#
safe_groupadd() {
	if grep -q "^$1:" $root/etc/group; then
		echo "Found already existing group '$1'."
	else
		echo "Creating group '$1' ..."
		echo "$1:x:$2:" >> $root/etc/group
	fi
}

