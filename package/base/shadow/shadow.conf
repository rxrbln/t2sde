# --- T2-COPYRIGHT-NOTE-BEGIN ---
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# 
# T2 SDE: package/.../shadow/shadow.conf
# Copyright (C) 2004 - 2005 The T2 SDE Project
# Copyright (C) 1998 - 2003 ROCK Linux Project
# 
# More information can be found in the files COPYING and README.
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; version 2 of the License. A copy of the
# GNU General Public License can be found in the file COPYING.
# --- T2-COPYRIGHT-NOTE-END ---

pp_shadow() {
	# Well - we want all the shadow stuff groupped into the 
	# "service / security domain" shadow; as it was up to 4.0.3 
	# (or maybe even slightly higher versions).
	# We do it like this to prevent recreating the patch for 
	# every new release.
	sed -i 's/pam_start *("[^l].*"/pam_start ("shadow"/g' src/*.c
}

pc_shadow() {
    # Need to rebuild libtool files, resolve possible version conflicts
    libtoolize --copy --force
}

pm_shadow() {
	cp etc/limits etc/login.access $root/etc/
	cp etc/login.defs.linux $root/etc/login.defs
	touch $root/var/log/lastlog $root/var/log/faillog
	[ -f $root/usr/bin/login ] && mv $root/usr/bin/login  $root/bin/
	[ -f $root/usr/bin/su    ] && mv $root/usr/bin/su     $root/bin/
	mkdir -p $root/etc/default
	echo 'SHELL=/bin/bash' > $root/etc/default/useradd
}

hook_add postpatch 5 "pp_shadow"
hook_add preconf 5 "pc_shadow"
hook_add postmake 5 "pm_shadow"

confopt="$confopt --enable-shared --disable-desrpc"
libdir="$root/lib"

