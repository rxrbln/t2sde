# --- T2-COPYRIGHT-NOTE-BEGIN ---
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# 
# T2 SDE: package/.../subversion/subversion.conf
# Copyright (C) 2004 - 2014 The T2 SDE Project
# Copyright (C) 1998 - 2003 ROCK Linux Project
# 
# More information can be found in the files COPYING and README.
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; version 2 of the License. A copy of the
# GNU General Public License can be found in the file COPYING.
# --- T2-COPYRIGHT-NOTE-END ---

# use the apache prefix
# . $base/package/*/apache/apache.conf

if [ $prefix_auto = 1 ]; then
	prefix="usr"
	set_confopt
fi

# APR is mandatory, so no additional test needed.
#
pkgprefix -t apr
var_append extraconfopt " " "--with-apr=$root/$( pkgprefix apr )"
pkgprefix -t apr-util
var_append extraconfopt " " "--with-apr-util=$root/$( pkgprefix apr-util )"

# all this is to build the apache server-side module and if so, no modification
# to httpd.conf are done ...
#
if pkginstalled apache; then
	var_append extraconfopt " " "--with-apxs=$root/$( pkgprefix bindir apache )/apxs"
	var_append extraconfopt " " "--disable-mod-activation"
fi

if pkginstalled bdb; then
	var_append extraconfopt ' ' '--with-berkeley-db --enable-bdb6'
fi

# build and install perl bindings
svn_inst_pl() {
	make swig-pl
	make install-swig-pl
}

# build and install python bindings
svn_inst_py() {
#	PYTHON_SITE=`python -c "import os,sys; print os.path.join(sys.prefix, 'lib','python'+sys.version[:3],'site-packages')"`
	make swig-py
	make install-swig-py #\
#		swig_pydir=$PYTHON_SITE/svn/libsvn \
#		swig_pydir_extra=$PYTHON_SITE/svn
}

# build and install ruby bindings
svn_inst_rb() {
        make swig-rb
        make install-swig-rb 
}

hook_add postmake 4 "cp -vrf tools $root$docdir"

# we need svn-config for anjuta
#hook_add premake 3 "sed -i 's/@SVN_DB_[^@]*@//g' svn-config"
#hook_add postmake 5 "cp -vf svn-config $bindir"

# if swig is present build and install the perl and python bindings
# TODO: fix for cross build
if pkginstalled swig && atstage "native"; then
	pkginstalled perl && hook_add postmake 5 "svn_inst_pl"
	pkginstalled python && hook_add postmake 5 "svn_inst_py"
	pkginstalled ruby && hook_add postmake 5 "svn_inst_rb"
else
	var_append confopt ' ' '--without-swig'
fi

# use system wide serf
if pkginstalled serf; then
	pkgprefix -t serf
	var_append extraconfopt " " "--with-serf=$root/$( pkgprefix serf )"
fi

[[ $libdir = *lib64 ]] && hook_add premake 3 "sed -i 's/usr\/lib /usr\/lib64 /' Makefile"

var_append makeinstopt ' ' '-j1'
