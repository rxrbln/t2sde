# --- T2-COPYRIGHT-NOTE-BEGIN ---
# T2 SDE: package/*/gn/gn.conf
# Copyright (C) 2021 The T2 SDE Project
# 
# This Copyright note is generated by scripts/Create-CopyPatch,
# more information can be found in the files COPYING and README.
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License version 2.
# --- T2-COPYRIGHT-NOTE-END ---

makeopt=
makeinstopt=

# Downloaded tarball does not contain toplevel project dir, sigh
var_insert taropt ' ' '--one-top-level'

hook_add premake 5 'gn_premake'
hook_add inmake 5 'gn_inmake'
hook_add postmake 5 'gn_postmake'

# Version number needs the .git dir which is not acceptable and not provided
# in tarballs so we hardcode it.
gn_premake() {
	mkdir $builddir/$pkg-$ver/out/
	cp $confdir/last_commit_position.h $builddir/$pkg-$ver/out/
}

gn_inmake() {
	./build/gen.py
	ninja -C out/ -j$SDECFG_PARALLEL_MAX
}

gn_postmake() {
	install -D -m755 out/gn $root/$bindir
	install -D -m644 docs/* $root/$docdir
}
