# --- T2-COPYRIGHT-NOTE-BEGIN ---
# This copyright note is auto-generated by scripts/Create-CopyPatch.
# 
# T2 SDE: package/.../gcc/g5-cell-not-power7.patch
# Copyright (C) 2020 The T2 SDE Project
# 
# More information can be found in the files COPYING and README.
# 
# This patch file is dual-licensed. It is available under the license the
# patched project is licensed under, as long as it is an OpenSource license
# as defined at http://www.opensource.org/ (e.g. BSD, X11) or under the terms
# of the GNU General Public License as published by the Free Software
# Foundation; either version 2 of the License, or (at your option) any later
# version.
# --- T2-COPYRIGHT-NOTE-END ---

Glibc uses .machine to determine assembly optimizations to use, and G5 as well
as cell, and even power4 -maltivec resulted in power7. Mask _ALTIVEC away
as the .machine selection already did for GFX and GPOPT.

Signed-of-by: Ren√© Rebe <rene@exactcode.de>

--- gcc-10.2.0/gcc/config/rs6000/rs6000.c.vanilla	2020-10-06 13:00:54.419189736 +0200
+++ gcc-10.2.0/gcc/config/rs6000/rs6000.c	2020-10-06 13:00:09.418189978 +0200
@@ -5531,7 +5531,7 @@
   HOST_WIDE_INT flags = rs6000_isa_flags;
 
   /* Disable the flags that should never influence the .machine selection.  */
-  flags &= ~(OPTION_MASK_PPC_GFXOPT | OPTION_MASK_PPC_GPOPT);
+  flags &= ~(OPTION_MASK_PPC_GFXOPT | OPTION_MASK_PPC_GPOPT | OPTION_MASK_ALTIVEC);
 
   if ((flags & (ISA_3_1_MASKS_SERVER & ~ISA_3_0_MASKS_SERVER)) != 0)
     return "power10";
