[COPY] --- T2-COPYRIGHT-BEGIN ---
[COPY] t2/package/*/lld/lld.desc
[COPY] Copyright (C) 2008 - 2025 The T2 SDE Project
[COPY] SPDX-License-Identifier: GPL-2.0
[COPY] --- T2-COPYRIGHT-END ---

[I] The LLVM Linker

[T] LLD is a linker from the LLVM project that is a drop-in replacement for
[T] system linkers and runs much faster than them. It also provides features
[T] that are useful for toolchain developers.
[T]
[T] The linker supports ELF (Unix), PE/COFF (Windows), Mach-O (macOS) and
[T] WebAssembly in descending order of completeness.

[U] https://lld.llvm.org

[A] University of Illinois/NCSA
[A] Chris Lattner <clattner@apple.com>
[M] Rene Rebe <rene@t2-project.org>

[C] extra/development
[F] OBJDIR CROSS LATOMIC.sparc LATOMIC.sparc64 NO-LTO.gcc
[R] - alpha arc avr32 blackfin cris ia64 m68k microblaze nios2 openrisc

[L] BSD
[S] Stable
[V] 21.1.1
[P] X ?----5---9 102.620

[CV-GROUP] llvmorg
[D] 1f3da872c91e3dd74fedee16ab57804188c5f9208b93cddc53366b15 lld-21.1.1.src.tar.xz https://github.com/llvm/llvm-project/releases/download/llvmorg-21.1.1/
[D] 54511b601c65de2e8231ac05573a35ca4de0c2c7ad8c424d1fd614af llvm-cmake-21.1.1.src.tar.xz !https://github.com/llvm/llvm-project/releases/download/llvmorg-21.1.1/cmake-21.1.1.src.tar.xz

var_append cmakeopt ' ' "-DBUILD_SHARED_LIBS=ON -DLLVM_BUILD_LLVM_DYLIB=ON -DLLVM_LINK_LLVM_DYLIB=ON"

#var_append cmakeopt ' ' -DLLD_SHARED_LIBS=ON
#var_append cmakeopt ' ' -DLLD_SHARED_LIBS=ON
#-DBUILD_SHARED_LIBS=ON
#-DLLVM_BUILD_LLVM_DYLIB=ON -DLLVM_LINK_LLVM_DYLIB=ON

cmake_mod() {
	tar $taropt `match_source_file -p cmake` -C ..
	mv -vf ../cmake-*src ../../cmake
}
hook_add preconf 5 cmake_mod

if atstage toolchain; then
	var_append cmakeopt ' ' -DLLVM_DEFAULT_TARGET_TRIPLE=$arch_target
	var_append cmakeopt ' ' -DLLVM_LIBRARY_DIR=$root$libdir
elif atstage cross; then
	var_append cmakeopt ' ' -DLLVM_MAIN_INCLUDE_DIR=$root$includedir
	#var_append cmakeopt ' ' -DLLVM_LIBRARY_DIR=$root$libdir

	var_append GCC_WRAPPER_REMOVE ' ' -L$sysroot/TOOLCHAIN/cross/lib
	var_append GCC_WRAPPER_FILTER '|' "sed 's,$root/TOOLCHAIN.*libLLVM\(.*\)\.[as].*,-lLLVM\1,g'"
	var_append GCC_WRAPPER_FILTER '|' "sed 's,^/lib64/libcurses.so,-lcurses,'"
	var_append GCC_WRAPPER_FILTER '|' "sed 's,$root/lib64/libcurses.so,-lcurses,'"
fi

[ "${libdir##*/lib}" ] && var_append cmakeopt ' ' "-DLLVM_LIBDIR_SUFFIX=${libdir##*/lib}"
