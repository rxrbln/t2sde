# --- T2-COPYRIGHT-NOTE-BEGIN ---
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# 
# T2 SDE: package/.../bluez-alsa/aptx-option.patch
# Copyright (C) 2018 The T2 SDE Project
# 
# More information can be found in the files COPYING and README.
# 
# This patch file is dual-licensed. It is available under the license the
# patched project is licensed under, as long as it is an OpenSource license
# as defined at http://www.opensource.org/ (e.g. BSD, X11) or under the terms
# of the GNU General Public License as published by the Free Software
# Foundation; either version 2 of the License, or (at your option) any later
# version.
# --- T2-COPYRIGHT-NOTE-END ---

Added a nice option to quickly disable apt-X support for testing.

  - Ren√© Rebe <rene@exactcode.de

--- ./src/bluez.c.vanilla	2018-06-04 22:41:46.749223096 +0200
+++ ./src/bluez.c	2018-06-04 22:42:14.401223423 +0200
@@ -742,6 +742,7 @@
 				A2DP_CODEC_MPEG24, &bluez_a2dp_aac, sizeof(bluez_a2dp_aac));
 #endif
 #if ENABLE_APTX
+		if (!config.disable_aptx)
 		bluez_register_a2dp_endpoint(BLUETOOTH_UUID_A2DP_SOURCE, BLUETOOTH_PROFILE_A2DP_SOURCE,
 				A2DP_CODEC_VENDOR_APTX, &bluez_a2dp_aptx, sizeof(bluez_a2dp_aptx));
 #endif
--- ./src/bluealsa.h.vanilla	2018-06-04 22:39:46.021221668 +0200
+++ ./src/bluealsa.h	2018-06-04 22:41:30.069222898 +0200
@@ -107,7 +107,10 @@
 	/* Control audio volume natively by the connected device. The disadvantage
 	 * of this control type is a monophonic volume change. */
 	bool a2dp_volume;
-
+#if ENABLE_APTX
+	/* For easy debugging, testing, A/B comparision, disable aptx */
+	bool disable_aptx;
+#endif
 };
 
 /* Structure describing registered D-Bus object. */
--- bluez-alsa-9045edb436ea755f395a2e09e4525b5defad286a/src/main.c	2018-03-02 11:38:46.000000000 +0100
+++ bluez-alsa-9045edb436ea755f395a2e09e4525b5defad286a-new/src/main.c	2018-06-04 20:52:59.173145905 +0200
@@ -63,6 +63,9 @@
 		{ "a2dp-force-mono", no_argument, NULL, 6 },
 		{ "a2dp-force-audio-cd", no_argument, NULL, 7 },
 		{ "a2dp-volume", no_argument, NULL, 8 },
+#if ENABLE_APTX
+		{ "disable-aptx", no_argument, NULL, 9 },
+#endif
 		{ 0, 0, 0, 0 },
 	};
 
@@ -199,6 +200,12 @@
 		case 8 /* --a2dp-volume */ :
 			config.a2dp_volume = true;
 			break;
+
+#if ENABLE_APTX
+		case 9 /* --disable-aptx */ :
+			config.disable_aptx = true;
+			break;
+#endif
 
 		default:
 			fprintf(stderr, "Try '%s --help' for more information.\n", argv[0]);
