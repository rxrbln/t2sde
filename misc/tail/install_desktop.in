#!/bin/sh
# --- T2-COPYRIGHT-BEGIN ---
# t2/misc/tail/install_desktop.in
# Copyright (C) 2004 - 2025 The T2 SDE Project
# SPDX-License-Identifier: GPL-2.0
# --- T2-COPYRIGHT-END ---

# Register a window-manager
#
register_wm() {
	local regdir=$root/usr/share/xsessions
	mkdir -p $regdir

	cat <<-EOT > "$regdir/$1"
[Desktop Entry]
Encoding=UTF-8
Type=XSession
Name=$2
Exec=$3
EOT
}

# Register a xdm - display manager
#
register_xdm() {
	local regdir=usr/share/registry
	mkdir -p $root/$regdir/xdm

	cat <<-EOT > "$root/$regdir/xdm/$1"
	name="$2"
	exec="$3"
	EOT
}

install_desktop() {
	local file="$1" regdir=usr/share/registry
	[ -e $root/$regdir/app ] || mkdir -p $root/$regdir/app

	echo "Installing ${file##*/} ..."
	sde_substitute $file > $root/$regdir/${file##*/}
}

for y in $(ls -1 $confdir/*.desktop 2> /dev/null); do
	hook_add postinstall 6 "install_desktop '$y'"
done
