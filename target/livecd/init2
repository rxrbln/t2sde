#!/bin/sh

echo "T2 live setup ..."

mkdir -p /tmp ; chmod 1777 /tmp

echo "Setting up overlay mounts ..."

mkdir /tmp/live-overlay
mount -t unionfs -o dirs=/tmp/live-overlay:/mnt/live=ro none /mnt/live

#TODO: Did not work - since a seperate home overlay would be nice later
#      on, review why this does not work.
#mkdir /tmp/home-overlay
#mount -t unionfs -o dirs=/tmp/home-overlay:/home=ro none /home

echo "Finalizing configuration ..."
cat /proc/mounts > /etc/mtab

rm -f /init{,2}

init="init= `cat /proc/cmdline`" ; init=${init##*init=} ; init=${init%% *}
# TODO: later on search other places if we want 100% backward compat.
[ "$init" ] || init=/sbin/init
exec $init $*

# s.th. went wrong - debug mode ,-)
exec sh --login

