#!/bin/sh

echo "T2 live setup ..."

echo "Setting up overlay mounts ..."

mkdir /tmp/etc-overlay
mount -t unionfs -o dirs=/tmp/etc-overlay:/etc=ro none /etc

mkdir /tmp/home-overlay
mount -t unionfs -o dirs=/tmp/home-overlay:/home=ro none /home

mkdir /tmp/var-overlay
mount -t unionfs -o dirs=/tmp/var-overlay:/var=ro none /var

mkdir /tmp/usr-overlay
mount -t unionfs -o dirs=/tmp/usr-overlay:/usr=ro none /usr


echo "Cleanup and configuration ..."

chmod 1777 /tmp
rm -rf /tmp/{bin,dev,etc,init*,lib,root,sbin,sys}
cat /proc/mounts > /etc/mtab


exec /sbin/init $*

# s.th. went wrong - debug mode ,-)
exec sh --login

