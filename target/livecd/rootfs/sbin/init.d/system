#!patch

--- system.vanilla	2005-11-07 01:45:58.000000000 +0100
+++ system	2005-11-07 01:47:13.000000000 +0100
@@ -66,6 +66,14 @@
 
 	title "Activating swap devices."
 	swapon -a || error=$?
+	for x in /dev/{hd,sd}??*; do
+		[ -e $x ] || continue
+		if disktype $x | grep -q Swap &&
+		   ! grep -q $x /proc/swaps; then
+			echo "Discovered swap space on $x, activating."
+			swapon $x
+		fi
+	done
     	status
 
 	title "Checking file systems."
@@ -88,14 +88,18 @@
 	fi
     	status
 
+if false; then
 	title "Mounting local file systems."
 	mount -n -o remount,rw / || error=$?
+fi
 	cat /proc/mounts > /etc/mtab
 	mount -a -t nocoda,nfs,devfs,proc,sysfs || error=$?
     	status
 
 	title "Refresh utmp, delete lock and tmp files and other stuff."
+if false; then
 	find /var/lock /var/run /tmp -mindepth 1 -print0 2> /dev/null | xargs --null rm -rf
+fi
 	rm -f /etc/nologin /nologin /fastboot ; touch /var/run/utmp
 	chmod 664 /var/run/utmp ; chown root:tty /var/run/utmp
 	mkdir /tmp/.ICE-unix && chmod 1777 /tmp/.ICE-unix
