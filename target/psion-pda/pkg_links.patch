# --- T2-COPYRIGHT-NOTE-BEGIN ---
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# 
# T2 SDE: target/psion-pda/pkg_links.patch
# Copyright (C) 2004 - 2005 The T2 SDE Project
# 
# More information can be found in the files COPYING and README.
# 
# This patch file is dual-licensed. It is available under the license the
# patched project is licensed under, as long as it is an OpenSource license
# as defined at http://www.opensource.org/ (e.g. BSD, X11) or under the terms
# of the GNU General Public License as published by the Free Software
# Foundation; either version 2 of the License, or (at your option) any later
# version.
# --- T2-COPYRIGHT-NOTE-END ---

Well - the patches does multiple things:

It fixes the genertor helpers to work with recent libraries and tools and on
non-x86 arches to be able to regenerate and thus strip a lot of stuff.

  - Rene Rebe <rene@exactcode.de>

diff -ur links-2.1pre16/Unicode/gen-cp links-2.1pre16-hacked/Unicode/gen-cp
--- links-2.1pre16/Unicode/gen-cp	2002-11-03 11:10:38.000000000 +0100
+++ links-2.1pre16-hacked/Unicode/gen-cp	2005-02-28 00:29:09.433976128 +0100
@@ -10,17 +10,17 @@
 	echo -n $i' ' 1>&2
 	echo
 	echo 'struct table_entry table_'$i' [] = {'
-	tail +3 $i.cp | sed 's/#.*$//' | grep '^0x[89a-zA-Z]' | sed 's/[ 	][ 	]*/ /g' | sed 's/[ 	]*$/ },/' | sed 's/ /, /' | sed 's/^[ 	]*/	{ /' | grep '.*,.*,'
+	tail -n +3 $i.cp | sed 's/#.*$//' | grep '^0x[89a-zA-Z]' | sed 's/[ 	][ 	]*/ /g' | sed 's/[ 	]*$/ },/' | sed 's/ /, /' | sed 's/^[ 	]*/	{ /' | grep '.*,.*,'
 	echo '	{ 0, 0 }'
 	echo '};'
 	echo
-	echo 'unsigned char *aliases_'$i' [] = {'`head -2 $i.cp | tail +2`', NULL };'
+	echo 'unsigned char *aliases_'$i' [] = {'`head -n 2 $i.cp | tail -n +2`', NULL };'
 	n=`expr $n + 1`
 done
 echo
 echo 'struct codepage_desc codepages [] = {'
 for i in $codepages; do
-	echo '	{ "'`head -1 $i.cp`'", aliases_'$i', table_'$i' },'
+	echo '	{ "'`head -n 1 $i.cp`'", aliases_'$i', table_'$i' },'
 done
 echo '	{ NULL, NULL, NULL }'
 echo '};'
diff -ur links-2.1pre16/Unicode/index.txt links-2.1pre16-hacked/Unicode/index.txt
--- links-2.1pre16/Unicode/index.txt	2002-10-14 11:13:16.000000000 +0200
+++ links-2.1pre16-hacked/Unicode/index.txt	2005-02-28 00:27:04.527964728 +0100
@@ -1,35 +1,4 @@
 7bit
 8859_1
-8859_2
-8859_3
-8859_4
-8859_5
-8859_6
-8859_7
-8859_8
-8859_9
-8859_10
-8859_13
-8859_14
 8859_15
-8859_16
-cp1250
-cp1251
-cp1252
-cp1256
-cp1257
-cp437
-cp737
-cp850
-cp852
-cp866
-cp1125
-macroman
-mac_lat2
-kamen
-koi8_r
-koi8_u
-koi8_ru
-tcvn5712
-viscii
 utf_8
--- links-2.1pre16/configure	2005-01-22 21:54:20.000000000 +0100
+++ links-2.1pre16-hacked/configure	2005-02-17 23:17:46.000000000 +0100
@@ -813,7 +813,7 @@
 AUTOCONF="./missing autoconf"
 AUTOMAKE="./missing automake"
 AUTOHEADER="./missing autoheader"
-image_formats="GIF PNG XBM"
+image_formats=""
 
 
 
--- links-2.1pre16/graphics/Makefile	2003-08-17 02:25:49.000000000 +0200
+++ links-2.1pre16-hacked/graphics/Makefile	2005-02-24 01:10:59.000000000 +0100
@@ -7,10 +7,10 @@
 	rm -f improcess gepns core pbm2png clip generate_font arrow
 
 improcess: improcess.c
-	gcc -o improcess $(CFLAGS) $(LDFLAFGS) -lpng improcess.c
+	gcc -o improcess $(CFLAGS) $(LDFLAFGS) -lpng -lz -lm improcess.c
 
 pbm2png: pbm2png.c
-	gcc -o pbm2png $(CFLAGS) $(LDFLAGS) -lpng pbm2png.c
+	gcc -o pbm2png $(CFLAGS) $(LDFLAGS) -lpng -lz -lm pbm2png.c
 
 genps: genps.c
 
@@ -20,4 +20,4 @@
 	gcc -o generate_font -lm -lpng -lz $(CFLAGS) $(LDFLAGS) generate_font.c
 
 arrow: arrow.c
-	gcc -o arrow $(CFLAGS) $(LDFLAGS) arrow.c -lpng
+	gcc -o arrow $(CFLAGS) $(LDFLAGS) arrow.c -lpng -lz -lm
--- links-2.1pre16/graphics/pbm2png.c	2002-05-05 22:47:32.000000000 +0200
+++ links-2.1pre16-hacked/graphics/pbm2png.c	2005-02-24 01:10:24.000000000 +0100
@@ -149,14 +149,14 @@
  sprintf(string,"%s%d.html",basename_,index);
  f=fopen(string,"w");
 
- fprintf(f,"<html><head><title>%s</title></head><body bgcolor=\"#000000\" text=\"#00ff00\" link=\"#ffff00\" vlink=\"#00ffff\"
+ fprintf(f,"<html><head><title>%s</title></head><body bgcolor=\"#000000\" text=\"#00ff00\" link=\"#ffff00\" vlink=\"#00ffff\"\
 alink=\"#ffff00\">\n",titlestring);
  fprintf(f,"<h1>%s, Page %d</h1>\n",titlestring,index+pageoffset);
  fprintf(f,"<p><table border=0 cellspacing=0 cellpadding=2><tr>");
  fprintf(f,"<td valign=\"top\"><table border=0 cellpadding=0 cellspacing=0><tr><td>");
  if (index)
  {
-  fprintf(f,"<a href=\"%s%d.html\"><img src=\"left.png\" border=0
+  fprintf(f,"<a href=\"%s%d.html\"><img src=\"left.png\" border=0\
 ></a>\n",basename_,index-1);
  }
  else
@@ -166,17 +166,17 @@
  fprintf(f,"</td><td>");
  if (index<filenumber-1)
  {
-  fprintf(f,"<a href=\"%s%d.html\">
+  fprintf(f,"<a href=\"%s%d.html\">\
 <img src=\"right.png\" border=0></a>\n",basename_,index+1);
  }
  else
  {
   fprintf(f,"<img src=\"right.png\" border=0>\n");
  }
- fprintf(f,"</td></tr><tr><td colspan=2><a href=\"index.html\">
+ fprintf(f,"</td></tr><tr><td colspan=2><a href=\"index.html\">\
 <img src=\"idx.png\" border=0 ></a></td>");
  fprintf(f,"</tr></table>");
- fprintf(f,"</td><td><img src=\"%s%d.png\" border=\"0\"
+ fprintf(f,"</td><td><img src=\"%s%d.png\" border=\"0\"\
 ></td>\n</tr></table>",basename_,index);
  fprintf(f,"</body></html>");
  fclose(f);
@@ -426,7 +426,7 @@
         int a,z;
  
         if (argc<7){
-                fprintf(stderr,"Usage: pbm2png <hundred_dpi> <basename_> <titlestring>
+                fprintf(stderr,"Usage: pbm2png <hundred_dpi> <basename_> <titlestring>\
 <bottom_html_code> <pageoffset> <ifname> [starting_filenumber]\n");
         return 0;
         }
--- links-2.1pre16/language.inc	2005-01-22 21:51:55.000000000 +0100
+++ links-2.1pre16-hacked/language.inc	2005-02-24 00:51:30.000000000 +0100
@@ -513,6 +513,7 @@
   { 0, NULL }
 };
 
+#ifdef WANT_NLS
 struct translation translation_belarusian [] = {
   { 0, NULL },
   {T__CHAR_SET, "koi8-ru" },
@@ -16416,39 +16417,10 @@
   { 0, NULL }
 };
 
+#endif
+
 struct translation_desc translations [] = {
   { translation_english },
-  { translation_belarusian },
-  { translation_brazilian_portuguese },
-  { translation_bulgarian },
-  { translation_catalan },
-  { translation_croatian },
-  { translation_czech },
-  { translation_danish },
-  { translation_dutch },
-  { translation_estonian },
-  { translation_finnish },
-  { translation_french },
-  { translation_galician },
-  { translation_german },
-  { translation_greek },
-  { translation_hungarian },
-  { translation_icelandic },
-  { translation_indonesian },
-  { translation_italian },
-  { translation_lithuanian },
-  { translation_norwegian },
-  { translation_polish },
-  { translation_portuguese },
-  { translation_romanian },
-  { translation_russian },
-  { translation_serbian },
-  { translation_slovak },
-  { translation_spanish },
-  { translation_swedish },
-  { translation_turkish },
-  { translation_ukrainian },
-  { translation_upper_sorbian },
   { NULL }
 };
 
