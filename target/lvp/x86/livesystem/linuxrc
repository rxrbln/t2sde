#!/bin/bash

mount -t proc none /proc
mount -t tmpfs none /tmp
mount -t devfs none /dev

cd /dev ; rm -f fd
ln -sf /proc/kcore      core
ln -sf /proc/self/fd    fd
ln -sf fd/0             stdin
ln -sf fd/1             stdout
ln -sf fd/2             stderr
ln -sf misc/psaux	mouse
cd /

exec < /dev/console > /dev/console 2> /dev/console ; cd /
export PATH="/sbin:/bin:/usr/sbin:/usr/bin"

for x in /etc/lvp/*.sh ; do
   if [ -f "$x" ] ; then
      echo ; echo "Running $x ..." ; sh $x
      echo "Setup script $x finished."
   fi
done

/sbin/startlvp

exec 2>/dev/null
for x in /mnt* ; do
	umount ${x}
	losetup -d /dev/loop/${x#/mnt}
done

umount /proc
umount /tmp
umount /dev
