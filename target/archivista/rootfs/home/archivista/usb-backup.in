
# find and mount the first partition of a usb device
mount_usb()
{
	mpoint="$1"

	# find first usb hard-disk
	dev=
	for x in /dev/sd[a-z] ; do
		[ -b "$x" ] || continue
		x=${x#/dev/}
		grep -q 0 /sys/block/$x/removable &&
		readlink /sys/block/$x/device/driver/[0-9]* | grep -q usb &&
		dev=/dev/$x && break
	done

	# find first partition on that device
	part=
	if [ "$dev" ]; then
		for x in $dev[0-9]*
		do part=$x ; break ; done
	else
		echo "No suitable USB hard-disk found."
		return 1
	fi

	if [ ! "$part" ]; then
		echo "No partition found."
		return 1
	fi

	mkdir -p $mpoint
	mount $part $mpoint

	if ! grep -q $mpoint /proc/mounts; then
		echo "USB hard-disk does not appear to be mounted correctly."
		return 1
	fi
}
