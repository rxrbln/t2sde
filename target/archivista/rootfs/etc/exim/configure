#!patch

Only allow local users with a .forwar file (so only the mail user, e.g.
not archivista) and no system aliases.

  - Rene Rebe <rene@exactcode.de>

--- configure.orig	2005-10-30 05:26:08.000000000 +0000
+++ configure	2005-10-30 06:55:41.000000000 +0000
@@ -459,14 +459,14 @@
 # listed below are the same as are used for .forward files; you might want
 # to set up different ones for pipe and file deliveries from aliases.
 
-system_aliases:
-  driver = redirect
-  allow_fail
-  allow_defer
-  data = ${lookup{$local_part}lsearch{/etc/aliases}}
-# user = exim
-  file_transport = address_file
-  pipe_transport = address_pipe
+#system_aliases:
+#  driver = redirect
+#  allow_fail
+#  allow_defer
+#  data = ${lookup{$local_part}lsearch{/etc/aliases}}
+## user = exim
+#  file_transport = address_file
+#  pipe_transport = address_pipe
 
 
 # This router handles forwarding using traditional .forward files in users'
@@ -500,13 +500,13 @@
 # local_part_suffix_optional
   file = $home/.forward
 # allow_filter
-  no_verify
-  no_expn
+#  no_verify
+#  no_expn
   check_ancestor
   file_transport = address_file
   pipe_transport = address_pipe
   reply_transport = address_reply
-
+  directory_transport = address_dictonary
 
 # This router matches local user mailboxes. If the router fails, the error
 # message is "Unknown user".
@@ -516,13 +516,13 @@
 # part_suffix options. Then, for example, xxxx-foo@your.domain will be treated
 # in the same way as xxxx@your.domain by this router.
 
-localuser:
-  driver = accept
-  check_local_user
-# local_part_suffix = +* : -*
-# local_part_suffix_optional
-  transport = local_delivery
-  cannot_route_message = Unknown user
+#localuser:
+#  driver = accept
+#  check_local_user
+## local_part_suffix = +* : -*
+## local_part_suffix_optional
+#  transport = local_delivery
+#  cannot_route_message = Unknown user
 
 
 
@@ -584,6 +584,13 @@
   envelope_to_add
   return_path_add
 
+address_dictonary:
+  driver = appendfile
+	maildir_format = true
+	delivery_date_add
+	envelope_to_add
+	return_path_add
+
 
 # This transport is used for handling autoreplies generated by the filtering
 # option of the userforward router.
