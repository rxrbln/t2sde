# --- T2-COPYRIGHT-NOTE-BEGIN ---
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# 
# T2 SDE: target/mnemosyne/build.sh
# Copyright (C) 2004 - 2005 The T2 SDE Project
# 
# More information can be found in the files COPYING and README.
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; version 2 of the License. A copy of the
# GNU General Public License can be found in the file COPYING.
# --- T2-COPYRIGHT-NOTE-END ---
pkgloop_action() {
	local rc=
	local desc_M=$( grep -e '^\[M\]' ./package/*/$pkg_name/$pkg_name.desc | cut -d' ' -f2- )
	local desc_P=$( grep -e '^\[P\]' ./package/*/$pkg_name/$pkg_name.desc | cut -d' ' -f2- )

        $cmd_buildpkg ; rc=$?

	admdir="build/${ROCKCFG_ID}/var/adm"

	if [ $ROCKCFG_TRG_MNEMOSYNE_COPYCACHE -eq 1 -a -r $admdir/cache/$pkg_name ]; then
		if grep -q -e '^\[M\] .*Alejandro Mery' -e '^\[P\] O' ./package/*/$pkg_name/$pkg_name.desc; then
			echo_status "mnemosyne: catching cache file."
			cp $admdir/cache/$pkg_name ./package/$pkg_tree/$pkg_name/$pkg_name.cache
		fi
	fi

	if [ -f ./.pause ]; then
		echo_status "mnemosyne: pausing building..."
		rm -f ./.pause
		exit 0
	fi
	return $rc
}

. target/generic/build.sh
